/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2023 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).TE=e.TE||{},e.TE.SourceHTML={}))}(this,(function(e){"use strict";var t=function(e,t){return-1!==t.indexOf(e)},r=function(e){return Array.isArray(e)},n=function(e){return"function"==typeof e},o=function(e,t){return e&&s(t)&&e instanceof t},i=function(e,t){return void 0===t&&(t=!0),"object"==typeof e&&(!t||o(e,Object))},s=function(e){return function(e){return void 0!==e}(e)&&!function(e){return null===e}(e)},c=function(e){return"string"==typeof e},l=window.location,a=function(e,t){return function(e){return o(e,RegExp)}(e)?e:(e=e.replace(/\//g,"\\/"),RegExp(e,s(t)?t:"g"))},u=function(e){return e.length},p=function(e,t){return void 0===t&&(t=!0),e=e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),t&&(e=e.replace(/&apos;/g,"'").replace(/&quot;/g,'"')),e},f=function(e,t){return e=e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;"),t&&(e=e.replace(/'/g,"&apos;").replace(/"/g,"&quot;")),e},h=function e(){for(var n=arguments.length,o=Array(n),c=0;c<n;c++)o[c]=arguments[c];for(var l=o.shift(),a=0,p=u(o);a<p;++a)for(var f in o[a])if(s(l[f]))if(r(l[f])&&r(o[a][f])){l[f]=[].concat(l[f]);for(var h=0,d=u(o[a][f]);h<d;++h)t(o[a][f][h],l[f])||l[f].push(o[a][f][h])}else i(l[f])&&i(o[a][f])?l[f]=e({},l[f],o[a][f]):l[f]=o[a][f];else l[f]=o[a][f];return l},d=function e(t){if(r(t))return t.map((function(r){return e(t)}));if(i(t)){for(var n in t)t[n]=e(t[n]);return t}return!1===t?"false":null===t?"null":!0===t?"true":""+t},g={};function m(e){if(!e)return"";var t;e=(t=e,Object.keys(t)).sort().reduce((function(t,r){return t[r]=e[r],t}),{});var r,n,o="";for(r in e)!1!==(n=e[r])&&null!==n&&(o+=" "+r,!0!==n&&(o+='="'+f(d(n),!0)+'"'));return o}function b(e){return!1!==e&&(c(e)?e=[e,e]:r(e)||(e=["",""]),s(e[1])||(e[1]=e[0])),e}g.insert=function(e,t,r,n){void 0===t&&(t=""),void 0===r&&(r={}),void 0===n&&(n=!1);return!1!==(n=b(n))&&this.trim(n[0],""),this.insert("<"+e+m(r)+(!1!==t?">"+t+"</"+e+">":" />")+(!1!==n?n[1]:""),-1,!0)},g.toggle=function(e,t,r,n){void 0===t&&(t=""),void 0===r&&(r={}),void 0===n&&(n=!1);var o=this,i=o.$(),s=i.after,c=i.before,l=i.value,u=function(e){return"<("+e+")(\\s(?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^/>'\"])*)?>"}(e),p=function(e){return"</("+e+")>"}(e),f=a(u+"$",""),h=a("^"+p,""),d=f.test(c),g=h.test(s);return g&&d?o.replace(h,"",1).replace(f,"",-1):(f=a("^"+u,""),h=a(p+"$",""),d=f.test(l),(g=h.test(l))&&d&&o.insert(l=l.replace(h,"").replace(f,"")),!l&&t&&o.insert(t),!1!==(n=b(n))&&o.trim(n[0],n[1]),o.wrap("<"+e+m(r)+">","</"+e+">"))},g.wrap=function(e,t,r,n){void 0===t&&(t=""),void 0===r&&(r={}),void 0===n&&(n=!1);var o=this,i=o.$();return i.after,i.before,!i.value&&t&&o.insert(t),!1!==(n=b(n))&&o.trim(n[0],n[1]),o.wrap("<"+e+m(r)+">","</"+e+">")};const v=l.protocol,{toggle:q}=g;let x="[\\w:.-]+",y=e=>"<("+e+")(\\s(?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^/>'\"])*)?>",k=e=>"</("+e+")>";function w(e){return!1!==e&&(c(e)?e=[e,e]:r(e)||(e=["",""]),s(e[1])||(e[1]=e[0])),e}const $={};$.blocks=function(){let e=this;return e.record(),function(e){let{after:t,end:r,before:n,start:o,value:i}=e.$(),s=/<(?:h([1-6])|p)(\s[^>]*)?>$/,c=/^<\/(?:h[1-6]|p)>/;if(!i){let i=t.split("\n").shift(),s=n.split("\n").pop();e.select(o-u(s),r+u(i))}e.match([s,/.*/,c],(function(t,r,n){let o=this,i=+(t[1]||0),l=t[2]||"",a=e.state.sourceHTML.elements||{},u=t[0]?a[t[0].slice(1,-1).split(/\s/)[0]]:["","",{}];!l&&u[2]&&(l=m(u[2])),o.replace(s,"",-1),o.replace(/\n+/g," "),o.replace(c,"",1);let p=u[3]||a.h1[3];!1!==(p=w(p))&&o.trim(p[0],p[1]),i?(++i,i>6?(o.wrap("<"+a.p[0]+(l||m(a.p[2]))+">","</"+a.p[0]+">"),r[0]&&r[0]!==a.h6[1]||o.insert(a.p[1])):(o.wrap("<"+a["h"+i][0]+(l||m(a["h"+i][2]))+">","</"+a["h"+i][0]+">"),r[0]&&r[0]!==a.p[1]||o.insert(a["h"+i][1]))):(o.wrap("<"+a.h1[0]+(l||m(a.h1[2]))+">","</"+a.h1[0]+">"),r[0]&&r[0]!==a.p[1]||o.insert(a.h1[1]))})),i&&(e.replace(a("^\\s*"+y("blockquote|h[1-6]|p(re)?")),""),e.replace(a(k("blockquote|h[1-6]|p(re)?")+"\\s*$"),""))}(e),e.record(),!1},$.bold=function(){let e=this,t=e.state.sourceHTML.elements||{};return e.record(),q.apply(e,t.b),!1},$.code=function(){let e=this;return e.record(),function(e){let t=/<(?:pre|code)(?:\s[^>]*)?>(?:\s*<code(?:\s[^>]*)?>)?$/,r=/^(?:<\/code>\s*)?<\/(?:pre|code)>/;e.match([t,/.*/,r],(function(n,o,i){let s,c=this,l=e.state.sourceHTML.elements;c.replace(t,"",-1),c.replace(r,"",1),i[0]?/^(?:<\/code>\s*)?<\/pre>/.test(i[0])?(s=l[""][3],!1!==(s=w(s))&&c.trim(s[0],s[1]),c.insert(p(o[0]))):i[0].slice(0,7)==="</"+l.code[0]+">"&&(s=l.pre[3],!1!==(s=w(s))&&c.trim(s[0],s[1]),c.wrap("<"+l.pre[0]+m(l.pre[2])+"><"+l.code[0]+m(l.code[2])+">","</"+l.code[0]+"></"+l.pre[0]+">")):(s=l.code[3],!1!==(s=w(s))&&c.trim(s[0],s[1]),c.wrap("<"+l.code[0]+m(l.code[2])+">","</"+l.code[0]+">").insert(f(o[0]||l.code[1])))}))}(e),e.record(),!1},$.image=function(e="URL:",t){let r=this,{after:o,before:i,value:s}=r.$(),c=r.state,l=c.sourceHTML.elements||{},a=c.sourceHTML.tab||c.source.tab||c.tab||"\t",u=i.split("\n").pop().match(/^(\s+)/),p=u&&u[1]||"",f=c.source.prompt;return n(f)&&f(e,s&&/^https?:\/\/\S+$/.test(s)?s:t||v+"//").then((e=>{if(!e)return void r.focus();let t=l.img;s&&(t[2].alt=s,r.record());let n=t[3]||!1;!1!==(n=w(n))&&r.trim(n[0],""),t[2].src=e,o&&"\n"!==o[0]||i&&"\n"!==i.slice(-1)?r.insert("<"+t[0]+m(t[2])+">"+(!1!==n?n[1]:""),-1,!0):(n=l.figure[3]||!1,!1!==(n=w(n))&&r.trim(n[0],n[1]),r.insert(""),r.wrap(p+"<"+l.figure[0]+m(l.figure[2])+">\n"+p+a,p+"\n</"+l.figure[0]+">"),r.insert("<"+t[0]+m(t[2])+">\n"+p+a,-1),r.wrap("<"+l.figcaption[0]+m(l.figcaption[2])+">","</"+l.figcaption[0]+">").insert(l.figcaption[1]))})).catch((e=>0)),r.record(),!1},$.italic=function(){let e=this,t=e.state.sourceHTML.elements||{};return e.record(),q.apply(e,t.i),!1},$.link=function(e="URL:",t){let r=this,{before:o,value:i}=r.$(),s=r.state,c=s.sourceHTML.elements||{},l=s.source.prompt;if(n(l)){let n,s,u,f=c.a;(s=a(y(f[0])).exec(o))?(u=!0,s=/\shref=(?:"([^"]+)"|'([^']+)'|([^>\/\s]+))/.exec(s[2]),n=p((s[1]||"")+(s[2]||"")+(s[3]||""))):(s=a("^\\s*"+y(f[0])).exec(i))&&(s=/\shref=(?:"([^"]+)"|'([^']+)'|([^>\/\s]+))/.exec(s[2]),n=p((s[1]||"")+(s[2]||"")+(s[3]||""))),l(e,i&&/^https?:\/\/\S+$/.test(i)?i:n||t||v+"//").then((e=>{if(!e)return void r.focus();i&&r.record(),f[2].href=e;let t={};/[.\/?&#]/.test(e[0])||/^(data|javascript|mailto):/.test(e)||-1===e.indexOf("://")||(t.rel="nofollow",t.target="_blank");let n=w(f[3]||!1);!1!==n||i||(n=[" "," "]),u&&q.call(r,f[0]),q.call(r,f[0],f[1],h(t,f[2]),n)})).catch((e=>0))}return r.record(),!1},$.quote=function(){let e=this;return e.record(),function(e){let t=/<(blockquote|q)(?:\s[^>]*)?>\s*$/,r=/^\s*<\/(blockquote|q)>/;e.match([t,/.*/,r],(function(n,o,i){let s,c=this,l=e.state,u=l.sourceHTML.tab||l.source.tab||l.tab||"\t",p=e.state.sourceHTML.elements||{};c.replace(t,"",-1),c.replace(r,"",1),i[0]?p.blockquote[0]===i[1]?!1!==(s=w(p[""][3]))&&c.trim(s[0],s[1]):p.q[0]===i[1]&&(!1!==(s=w(p.blockquote[3]))&&c.trim(s[0],s[1]),c.wrap("<"+p.blockquote[0]+m(p.blockquote[2])+">\n","\n</"+p.blockquote[0]+">").insert(o[0]||p.blockquote[1]),c.replace(a("(^|\\n)"),"$1"+u)):(!1!==(s=w(p.q[3]))&&c.trim(s[0],s[1]),c.wrap("<"+p.q[0]+m(p.q[2])+">","</"+p.q[0]+">").insert(o[0]||p.q[1]),c.replace(a("(^|\\n)"+u),"$1"))}))}(e),e.record(),!1},$.underline=function(){let e=this,t=e.state.sourceHTML.elements||{};return e.record(),q.apply(e,t.u),!1};const T={source:{type:"HTML"},sourceHTML:{elements:{"":["","text goes here…",{},""],a:["a","link text goes here…",{}],area:["area",!1,{}],b:["strong","text goes here…",{}],base:["base",!1,{href:""},"\n"],blockquote:["blockquote","",{},"\n"],br:["br",!1,{},["","\n"]],button:["button","text goes here…",{name:"",type:"submit"}," "],caption:["caption","caption goes here…",{},"\n"],code:["code","code goes here…",{}," "],col:["col",!1,{},"\n"],em:["em","text goes here…",{}],figcaption:["figcaption","caption goes here…",{},"\n"],figure:["figure","",{},"\n"],h1:["h1","title goes here…",{},"\n"],h2:["h2","title goes here…",{},"\n"],h3:["h3","title goes here…",{},"\n"],h4:["h4","title goes here…",{},"\n"],h5:["h5","title goes here…",{},"\n"],h6:["h6","title goes here…",{},"\n"],hr:["hr",!1,{},"\n"],i:["em","text goes here…",{}],img:["img",!1,{alt:"",src:""}," "],input:["input",!1,{name:"",type:"text"}," "],li:["li","list item goes here…",{},"\n"],link:["link",!1,{href:""},"\n"],meta:["meta",!1,{},"\n"],ol:["ol","",{},"\n"],option:["option","option goes here…",{},"\n"],p:["p","paragraph goes here…",{},"\n"],param:["param",!1,{name:""},"\n"],pre:["pre","text goes here…",{},"\n"],q:["q","quote goes here…",{}," "],script:["script","",{},"\n"],select:["select","",{name:""}," "],source:["source",!1,{src:""},"\n"],strong:["strong","text goes here…",{}],style:["style","",{},"\n"],td:["td","data goes here…",{},"\n"],textarea:["textarea","text goes here…",{name:""}," "],th:["th","title goes here…",{},"\n"],tr:["tr","",{},"\n"],track:["track",!1,{},"\n"],u:["u","text goes here…",{}],ul:["ul","",{},"\n"],wbr:["wbr",!1,{},["","\n"]]}}};e.canKeyDown=function(e,t){let r=t.state,n=r.sourceHTML.tab||r.source.tab||r.tab||"\t",o=r.sourceHTML.elements||{},{key:i,queue:s}=e;if(s.Control){let{after:e,before:r,end:n,start:c,value:l}=t.$(),p=e.split("\n").shift(),f=r.split("\n").pop(),h=f.match(/^(\s+)/),d=h&&h[1]||"";if("Enter"===i){let e=p.match(a(k(x)+"\\s*$","")),r=o[e&&e[1]||"p"]||o.p;return r[3]=["\n"+d,"\n"+d],t.select(s.Shift?c-u(f):n+u(p)),q.apply(t,r),t.record(),!1}}if(s.Alt||s.Control)return!0;if(">"===i){let e,{after:r,before:n,end:i}=t.$(),s=(n.split("\n").pop()+">").match(a(y(x)+"$","")),c=o[e=s&&s[1]||""];return!e||(c?!1!==c[1]?(">"===r[0]?t.select(i+1):t.insert(">",-1),t.insert("</"+e+">",1).insert(c[1])):">"===r[0]?t.insert(" /",-1).select(i+3):t.insert(" />",-1):(">"===r[0]?t.select(i+1):t.insert(">",-1),t.insert("</"+e+">",1)),t.record(),!1)}if("Enter"===i){let e,r,{after:i,before:c,value:l}=t.$(),p=i.split("\n").shift(),f=c.split("\n").pop(),h=f.match(/^(\s+)/),d=h&&h[1]||"",g=["li","option","p","td","th"],b=["script","style"];if(e=f.match(a(y(x)+"$",""))){let r=o[e[1]];if(r&&!1===r[1])return t.insert("\n"+d,-1).record(),!1}if(s.Shift){let{br:e}=o;return t.insert("<"+e[0]+m(e[2])+">"+(!1===e[1]?"":e[1]+"</"+e[0]+">")+"\n",-1).record(),!1}if(i&&c){for(let i=0,s=u(g);i<s;++i)if(r=g[i],a("^"+k(r),"").test(p)&&(e=f.match(a("^\\s*"+y(r),""))))return e[0]===f?(o[r]&&l&&o[r][1]===l?t.insert("").wrap("\n"+d+n,"\n"+d):q.call(t,r),t.record(),!1):(t.insert("</"+r+">\n"+d+"<"+r+(e[2]||"")+">",-1).insert(o[r]&&o[r][1]||"").record(),!1);for(let e=0,n=u(b);e<n;++e)if(r=b[e],a("^"+k(r),"").test(p)&&a(y(r)+"$","").test(f))return t.wrap("\n"+d,"\n"+d).insert(o[r]&&o[r][1]||"").record(),!1;for(let e=1;e<7;++e)if(p.startsWith("</"+o["h"+e][0]+">")&&f.match(a("^\\s*"+y(o["h"+e][0]),"")))return o["h"+e]&&l&&o["h"+e][1]===l?t.insert("").wrap("\n"+d+n,"\n"+d):t.insert("</"+o["h"+e][0]+">\n"+d+"<"+o.p[0]+">",-1).replace(a("^"+k(o["h"+e][0])),"</"+o.p[0]+">",1).insert(o.p[1]),t.record(),!1}}return!0},e.commands=$,e.state=T}));