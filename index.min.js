/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2023 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).TE=e.TE||{},e.TE.SourceHTML={}))}(this,(function(e){"use strict";var t=function(e,t){return-1!==t.indexOf(e)},r=function(e){return Array.isArray(e)},n=function(e){return"function"==typeof e},o=function(e,t){return e&&a(t)&&e instanceof t},i=function(e,t){return void 0===t&&(t=!0),"object"==typeof e&&(!t||o(e,Object))},a=function(e){return function(e){return void 0!==e}(e)&&!function(e){return null===e}(e)},s=function(e){return e.length},c=function(e,t){return void 0===t&&(t=!0),e=e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),t&&(e=e.replace(/&apos;/g,"'").replace(/&quot;/g,'"')),e},p=function(e){return Object.keys(e)},u=function(e,t){return e=e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;"),t&&(e=e.replace(/'/g,"&apos;").replace(/"/g,"&quot;")),e},l=function e(){for(var n=arguments.length,o=Array(n),c=0;c<n;c++)o[c]=arguments[c];for(var p=o.shift(),u=0,l=s(o);u<l;++u)for(var f in o[u])if(a(p[f]))if(r(p[f])&&r(o[u][f])){p[f]=[].concat(p[f]);for(var d=0,h=s(o[u][f]);d<h;++d)t(o[u][f][d],p[f])||p[f].push(o[u][f][d])}else i(p[f])&&i(o[u][f])?p[f]=e({},p[f],o[u][f]):p[f]=o[u][f];else p[f]=o[u][f];return p},f=function e(t){if(r(t))return t.map((function(r){return e(t)}));if(i(t)){for(var n in t)t[n]=e(t[n]);return t}return!1===t?"false":null===t?"null":!0===t?"true":""+t},d=window.location,h=function(e,t){return function(e){return o(e,RegExp)}(e)?e:(e=e.replace(/\//g,"\\/"),RegExp(e,a(t)?t:"g"))},v={};function g(e){if(!e)return"";e=p(e).sort().reduce((function(t,r){return t[r]=e[r],t}),{});var t,r,n="";for(t in e)!1!==(r=e[t])&&null!==r&&(n+=" "+t,!0!==r&&(n+='="'+u(f(r),!0)+'"'));return n}function b(e){return!1!==e&&("string"==typeof e?e=[e,e]:r(e)||(e=["",""]),a(e[1])||(e[1]=e[0])),e}v.insert=function(e,t,r,n){void 0===t&&(t=""),void 0===r&&(r={}),void 0===n&&(n=!1);return!1!==(n=b(n))&&this.trim(n[0],""),this.insert("<"+e+g(r)+(!1!==t?">"+t+"</"+e+">":" />")+(!1!==n?n[1]:""),-1,!0)},v.toggle=function(e,t,r,n){void 0===t&&(t=""),void 0===r&&(r={}),void 0===n&&(n=!1);var o=this,i=o.$(),a=i.after,s=i.before,c=i.value,p=function(e){return"<("+e+")(\\s(?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^/>'\"])*)?>"}(e),u=function(e){return"</("+e+")>"}(e),l=h(p+"$",""),f=h("^"+u,""),d=l.test(s),v=f.test(a);return v&&d?o.replace(f,"",1).replace(l,"",-1):(l=h("^"+p,""),f=h(u+"$",""),d=l.test(c),(v=f.test(c))&&d&&o.insert(c=c.replace(f,"").replace(l,"")),!c&&t&&o.insert(t),!1!==(n=b(n))&&o.trim(n[0],n[1]),o.wrap("<"+e+g(r)+">","</"+e+">"))},v.wrap=function(e,t,r,n){void 0===t&&(t=""),void 0===r&&(r={}),void 0===n&&(n=!1);var o=this,i=o.$();return i.after,i.before,!i.value&&t&&o.insert(t),!1!==(n=b(n))&&o.trim(n[0],n[1]),o.wrap("<"+e+g(r)+">","</"+e+">")};var m=d.protocol,w=v.toggle,$="[\\w:.-]+",y=function(e){return"<("+e+")(\\s(?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^/>'\"])*)?>"},k=function(e){return"</("+e+")>"};function x(e,r,n){return(!r||t("\n",r))&&(!n||"\n"===n[0])&&(!e||"\n"===e.slice(-1))}function q(e,t){return e===t.h1[1]||e===t.h2[1]||e===t.h3[1]||e===t.h4[1]||e===t.h5[1]||e===t.h6[1]||e===t.p[1]}var S={};S.blocks=function(){var e=this;return e.record(),function(e){var t=h(y("h([1-6])|p")+"$","i"),r=h("^"+k("h[1-6]|p"),"i"),n=e.$(),o=n.after,i=n.end,a=n.before,c=n.start,p=n.value,u=e.state,l=u.source.tab||u.tab||"\t",f=u.defaults||{};if(!p){var d=o.split("\n").shift(),v=a.split("\n").pop();d.trim()||v.trim()?e.select(c-s(v),i+s(d)):e.insert(f.h1[1]);var b=e.$();o=b.after,a=b.before,i=b.end,c=b.start,p=b.value}var m=a.split("\n").pop().match(/^(\s+)/),w=m&&m[1]||"";e.match([t,/[\s\S]*/,r],(function(n,o,i){var a=+(n[2]||0),s=n[3]||"",c=n[1]?f[n[1]]:["","",{}];!s&&c[2]&&(s=g(c[2])),e.replace(t,"",-1),e.replace(/\n+/g," "),e.replace(r,"",1),a?++a>6?(e.wrap(w+"<"+f.p[0]+(s||g(f.p[2]))+">","</"+f.p[0]+">"),o[0]&&!q(o[0],f)||e.insert(f.p[1])):(e.wrap(w+"<"+f["h"+a][0]+(s||g(f["h"+a][2]))+">","</"+f["h"+a][0]+">"),o[0]&&!q(o[0],f)||e.insert(f["h"+a][1])):(e.wrap(w+"<"+f.h1[0]+(s||g(f.h1[2]))+">","</"+f.h1[0]+">"),o[0]&&!q(o[0],f)||e.insert(f.h1[1])),e.replace(h("^("+k("h[1-6]|p")+")\\s*("+k($)+")"),"$1\n"+w.replace(h("^"+l),"")+"$3",1)})),e.replace(h("^\\s*"+y("blockquote|h[1-6]|p(re)?")),""),e.replace(h(k("blockquote|h[1-6]|p(re)?")+"\\s*$"),"")}(e),e.record(),!1},S.bold=function(){var e=this,t=e.state.defaults||{},r=e.$().value;return e.record(),w.apply(e,[].concat(t.b,(!r||t.b[1]===r)&&" ")),!1},S.code=function(){var e=this;return e.record(),function(e){var t=/<(p|pre|code)(?:\s[^>]*)?>(?:\s*<code(?:\s[^>]*)?>)?$/,r=/^(?:<\/code>\s*)?<\/(p|pre|code)>/,n=e.$(),o=n.after;n.end;var i=n.before;n.start;var a=n.value,s=e.state;s.source.tab||s.tab;var p=e.state.defaults||{};!a&&x(i,a,o)?(e.trim("\n","\n"),e.wrap("<"+p.pre[0]+g(p.pre[2])+"><"+p.code[0]+g(p.code[2])+">","</"+p.code[0]+"></"+p.pre[0]+">").insert(u(p.code[1]))):e.match([t,/[\s\S]*/,r],(function(n,o,i){e.replace(t,"",-1),e.replace(r,"",1),x(n[0],o[0],i[0])||p.p[0]===i[1]||p.pre[0]===i[1]?(e.trim("\n","\n"),p.pre[0]===i[1]?(e.wrap("<"+p.p[0]+g(p.p[2])+">","</"+p.p[0]+">").insert(c(o[0])),o[0]&&o[0]!==p.code[1]||e.insert(p.p[1])):(e.wrap("<"+p.pre[0]+g(p.pre[2])+"><"+p.code[0]+g(p.code[2])+">","</"+p.code[0]+"></"+p.pre[0]+">").insert(u(o[0])),o[0]&&o[0]!==p.p[1]||e.insert(p.code[1]))):p.code[0]===i[1]?e.insert(c(o[0])):w.apply(e,[].concat(p.code,(!o||p.code[1]===o)&&" "))}))}(e),e.record(),!1},S.image=function(e,t){void 0===e&&(e="URL:");var r=this,o=r.$(),i=o.after,a=o.before,s=o.value,c=r.state,p=c.source.tab||c.tab||"\t",u=c.defaults||{},l=a.split("\n").pop().match(/^(\s+)/),f=l&&l[1]||"",d=c.source.prompt;return n(d)&&d(e,s&&/^https?:\/\/\S+$/.test(s)?s:t||m+"//").then((function(e){if(e){var t=[].concat(u.img);s&&(t[2].alt=s,r.record()),t[2].src=e,x(a,s,i)?(r.insert("").trim("\n","\n"),r.wrap(f+"<"+u.figure[0]+g(u.figure[2])+">\n"+f+p,f+"\n</"+u.figure[0]+">"),r.insert("<"+t[0]+g(t[2])+">\n"+f+p,-1),r.wrap("<"+u.figcaption[0]+g(u.figcaption[2])+">","</"+u.figcaption[0]+">").insert(u.figcaption[1])):r.trim(" ","").insert("<"+t[0]+g(t[2])+">"+(i?" ":""),-1,!0)}else r.focus()})).catch((function(e){return 0})),r.record(),!1},S.italic=function(){var e=this,t=e.state.defaults||{},r=e.$().value;return e.record(),w.apply(e,[].concat(t.i,(!r||t.i[1]===r)&&" ")),!1},S.link=function(e,r){void 0===e&&(e="URL:");var o=this,i=o.$(),a=i.after,p=i.end,u=i.before,f=i.value,d=o.state,v=d.defaults||{},g=d.source.prompt;if(n(g)){var b,$,k,x=[].concat(v.a);($=h(y(x[0])).exec(u))?(k=!0,o.select($.index+s($[0]),p+a.indexOf("</"+x[0]+">")),$=/\shref=(?:"([^"]+)"|'([^']+)'|([^>\/\s]+))/.exec($[2]),b=c(($[1]||"")+($[2]||"")+($[3]||""))):($=h("^\\s*"+y(x[0])).exec(f))&&($=/\shref=(?:"([^"]+)"|'([^']+)'|([^>\/\s]+))/.exec($[2]),b=c(($[1]||"")+($[2]||"")+($[3]||""))),g(e,f&&/^https?:\/\/\S+$/.test(f)?f:b||r||m+"//").then((function(e){if(e){f&&o.record(),x[2].href=e;var r={};/[.\/?&#]/.test(e[0])||/^(data|javascript|mailto):/.test(e)||!t("://",e)||(r.rel="nofollow",r.target="_blank"),k&&w.call(o,x[0]),w.call(o,x[0],x[1],l(r,x[2]),(!f||x[1]===f)&&" ")}else o.focus()})).catch((function(e){return 0}))}return o.record(),!1},S.quote=function(){var e=this;return e.record(),function(e){var r=/<(blockquote)(?:\s[^>]*)?>\s*(<p(?:\s[^>]*)?>)?$/,n=/^(<\/p>)?\s*<\/(blockquote)>/,o=e.$(),i=o.after,a=o.end,c=o.before,p=o.start,u=o.value,l=e.state,f=l.source.tab||l.tab||"\t",d=e.state.defaults||{};if(!u){var h=i.split("\n").shift(),v=c.split("\n").pop();h.trim()||v.trim()?e.select(p-s(v),a+s(h)):e.insert(d.p[1]);var b=e.$();i=b.after,c=b.before,a=b.end,p=b.start,u=b.value}var m=c.split("\n").pop().match(/^(\s+)/),w=m&&m[1]||"";e.match([r,/[\s\S]*/,n],(function(o,i,a){d.blockquote[0]===a[1]||d.blockquote[0]===a[2]?(e.replace(r,"",-1),e.replace(n,"",1),e.pull(f)):t("\n",i[0])||/<\/(figure|form|dl|h[1-6]|[ou]l|p(re)?|table)>/i.test(i[0])?(e.wrap(w+"<"+d.blockquote[0]+g(d.blockquote[2])+">\n","\n"+w+"</"+d.blockquote[0]+">"),e.push(f)):e.wrap(w+"<"+d.blockquote[0]+g(d.blockquote[2])+">\n"+f+"<"+d.p[0]+g(d.p[2])+">","</"+d.p[0]+">\n"+w+"</"+d.blockquote[0]+">")}))}(e),e.record(),!1},S.underline=function(){var e=this,t=e.state.defaults||{},r=e.$().value;return e.record(),w.apply(e,[].concat(t.u,(!r||t.u[1]===r)&&" ")),!1};var E={defaults:{"":["","text goes here…",{}],a:["a","link text goes here…",{}],area:["area",!1,{}],b:["strong","text goes here…",{}],base:["base",!1,{href:""}],blockquote:["blockquote","quote goes here…",{}],br:["br",!1,{}],button:["button","text goes here…",{name:"",type:"submit"}],caption:["caption","table caption goes here…",{}],code:["code","code goes here…",{}],col:["col",!1,{}],dd:["dd","data goes here…",{}],dl:["dl","",{}],dt:["dt","title goes here…",{}],em:["em","text goes here…",{}],figcaption:["figcaption","image caption goes here…",{}],figure:["figure","",{}],h1:["h1","title goes here…",{}],h2:["h2","title goes here…",{}],h3:["h3","title goes here…",{}],h4:["h4","title goes here…",{}],h5:["h5","title goes here…",{}],h6:["h6","title goes here…",{}],hr:["hr",!1,{}],i:["em","text goes here…",{}],img:["img",!1,{alt:"",src:""}],input:["input",!1,{name:"",type:"text"}],li:["li","list item goes here…",{}],link:["link",!1,{href:""}],meta:["meta",!1,{}],ol:["ol","",{}],option:["option","option goes here…",{}],p:["p","paragraph goes here…",{}],param:["param",!1,{name:""}],pre:["pre","text goes here…",{}],q:["q","quote goes here…",{}],script:["script","code goes here…",{}],select:["select","",{name:""}],source:["source",!1,{src:""}],strong:["strong","text goes here…",{}],style:["style","code goes here…",{}],tbody:["tbody","",{}],td:["td","data goes here…",{}],textarea:["textarea","value goes here…",{name:""}],tfoot:["tfoot","",{}],th:["th","title goes here…",{}],thead:["thead","",{}],tr:["tr","",{}],track:["track",!1,{}],u:["u","text goes here…",{}],ul:["ul","",{},"\n"],wbr:["wbr",!1,{}]},source:{type:"HTML"}};e.canKeyDown=function(e,t){var r=t.state,n=r.source.tab||r.tab||"\t",o=r.defaults||{},i=e.key,a=e.queue;if(a.Control){var c=t.$(),p=c.after,u=c.before,l=c.end,f=c.start;c.value;var d=p.split("\n").shift(),v=u.split("\n").pop(),b=v.match(/^(\s+)/),m=b&&b[1]||"";if("Enter"===i){var x=d.match(h(k($)+"\\s*$","")),q=o[x&&x[1]||"p"]||o.p;return q[3]=["\n"+m,"\n"+(!a.Shift&&p&&h("^\\s*"+k($)).test(p.split("\n")[1]||"")?m.replace(h("^"+n),""):m)],t.select(a.Shift?f-s(v):l+s(d)),w.apply(t,q),t.record(),!1}}if(a.Alt||a.Control)return!0;if(">"===i){var S=t.$(),E=S.after,T=S.before,j=S.end;E.split("\n").shift();var O,A=T.split("\n").pop(),L=A.match(/^(\s+)/),R=L&&L[1]||"",M=(A+">").match(h(y($)+"$","")),_=o[O=M&&M[1]||""];return!O||(_?!1!==_[1]?(">"===E[0]?t.select(j+1):t.insert(">",-1),t.insert("</"+O+">",1).insert(_[1]),"blockquote"===_[0]?(t.insert(o.p[1]),t.wrap("\n"+R+n+"<"+o.p[0]+g(o.p[2])+">","</"+o.p[0]+">\n"+R)):"dl"===_[0]?(t.insert(o.dt[1]),t.wrap("\n"+R+n+"<"+o.dt[0]+g(o.dt[2])+">","</"+o.dt[0]+">\n"+R)):"ol"===_[0]||"ul"===_[0]?(t.insert(o.li[1]),t.wrap("\n"+R+n+"<"+o.li[0]+g(o.li[2])+">","</"+o.li[0]+">\n"+R)):"select"===_[0]?(t.insert(o.option[1]),t.wrap("\n"+R+n+"<"+o.option[0]+g(o.option[2])+">","</"+o.option[0]+">\n"+R)):"tbody"!==_[0]&&"tfoot"!==_[0]&&"thead"!==_[0]||(t.insert(o.tr[1]),t.wrap("\n"+R+n+"<"+o.tr[0]+g(o.tr[2])+">","</"+o.tr[0]+">\n"+R))):">"===E[0]?t.insert(" /",-1).select(j+3):t.insert(" />",-1):(">"===E[0]?t.select(j+1):t.insert(">",-1),t.insert("</"+O+">",1)),t.record(),!1)}if("Enter"===i){var C,H,U=t.$(),W=U.after,D=U.before,K=U.value,P=W.split("\n").shift(),z=D.split("\n").pop(),B=z.match(/^(\s+)/),F=B&&B[1]||"",G=["dd","li","option","p","td","th"],I=["pre","script","style"];if(C=z.match(h(y($)+"$",""))){var J=o[C[1]];if(J&&!1===J[1])return t.insert("\n"+F,-1).record(),!1}if(a.Shift){var N=o.br;return t.insert("<"+N[0]+g(N[2])+">"+(!1===N[1]?"":N[1]+"</"+N[0]+">")+"\n",-1).record(),!1}if(W&&D){if(P.startsWith("</"+o.dt[0]+">")&&z.match(h("^\\s*"+y(o.dt[0]),"")))return K&&o.dt[1]===K?t.insert("").wrap("\n"+F+n,"\n"+F):t.insert("</"+o.dt[0]+">\n"+F+"<"+o.dd[0]+g(o.dd[2])+">",-1).replace(h("^"+k(o.dt[0])),"</"+o.dd[0]+">",1).insert(o.dd[1]),t.record(),!1;for(var Q=0,V=s(G);Q<V;++Q)if(h("^"+k(H=G[Q]),"").test(P)&&(C=z.match(h("^\\s*"+y(H),""))))return C[0]===z?(o[H]&&K&&o[H][1]===K?t.insert("").wrap("\n"+F+n,"\n"+F):w.call(t,H),t.record(),!1):(t.insert("</"+H+">\n"+F+"<"+H+(C[2]||"")+">",-1).insert(o[H]&&o[H][1]||"").record(),!1);for(var X=0,Y=s(I);X<Y;++X)if(h("^"+k(H=I[X]),"").test(P)&&h(y(H)+"$","").test(z))return t.wrap("\n"+F,"\n"+F).insert(o[H]&&o[H][1]||"").record(),!1;for(var Z=1;Z<7;++Z)if(P.startsWith("</"+o["h"+Z][0]+">")&&z.match(h("^\\s*"+y(o["h"+Z][0]),"")))return o["h"+Z]&&K&&o["h"+Z][1]===K?t.insert("").wrap("\n"+F+n,"\n"+F):t.insert("</"+o["h"+Z][0]+">\n"+F+"<"+o.p[0]+g(o.p[2])+">",-1).replace(h("^"+k(o["h"+Z][0])),"</"+o.p[0]+">",1).insert(o.p[1]),t.record(),!1}}return!0},e.commands=S,e.state=E,Object.defineProperty(e,"__esModule",{value:!0})}));