/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2023 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).TE=e.TE||{},e.TE.SourceHTML={}))}(this,(function(e){"use strict";var t=function(e,t){return-1!==t.indexOf(e)},r=function(e){return Array.isArray(e)},n=function(e){return"function"==typeof e},o=function(e,t){return e&&i(t)&&e instanceof t},a=function(e,t){return void 0===t&&(t=!0),"object"==typeof e&&(!t||o(e,Object))},i=function(e){return function(e){return void 0!==e}(e)&&!function(e){return null===e}(e)},c=function(e){return"string"==typeof e},s=function(e){return e.length},u=function(e,t){return void 0===t&&(t=!0),e=e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),t&&(e=e.replace(/&apos;/g,"'").replace(/&quot;/g,'"')),e},l=function(e){return Object.keys(e)},p=function(e,t){return e=e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;"),t&&(e=e.replace(/'/g,"&apos;").replace(/"/g,"&quot;")),e},f=function e(){for(var n=arguments.length,o=Array(n),c=0;c<n;c++)o[c]=arguments[c];for(var u=o.shift(),l=0,p=s(o);l<p;++l)for(var f in o[l])if(i(u[f]))if(r(u[f])&&r(o[l][f])){u[f]=[].concat(u[f]);for(var h=0,d=s(o[l][f]);h<d;++h)t(o[l][f][h],u[f])||u[f].push(o[l][f][h])}else a(u[f])&&a(o[l][f])?u[f]=e({},u[f],o[l][f]):u[f]=o[l][f];else u[f]=o[l][f];return u},h=function e(t){if(r(t))return t.map((function(r){return e(t)}));if(a(t)){for(var n in t)t[n]=e(t[n]);return t}return!1===t?"false":null===t?"null":!0===t?"true":""+t},d=window.location,v=function(e,t){return function(e){return o(e,RegExp)}(e)?e:(e=e.replace(/\//g,"\\/"),RegExp(e,i(t)?t:"g"))},g={};function b(e){if(!e)return"";e=l(e).sort().reduce((function(t,r){return t[r]=e[r],t}),{});var t,r,n="";for(t in e)!1!==(r=e[t])&&null!==r&&(n+=" "+t,!0!==r&&(n+='="'+p(h(r),!0)+'"'));return n}function m(e){return!1!==e&&(c(e)?e=[e,e]:r(e)||(e=["",""]),i(e[1])||(e[1]=e[0])),e}g.insert=function(e,t,r,n){void 0===t&&(t=""),void 0===r&&(r={}),void 0===n&&(n=!1);return!1!==(n=m(n))&&this.trim(n[0],""),this.insert("<"+e+b(r)+(!1!==t?">"+t+"</"+e+">":" />")+(!1!==n?n[1]:""),-1,!0)},g.toggle=function(e,t,r,n){void 0===t&&(t=""),void 0===r&&(r={}),void 0===n&&(n=!1);var o=this,a=o.$(),i=a.after,c=a.before,s=a.value,u=function(e){return"<("+e+")(\\s(?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^/>'\"])*)?>"}(e),l=function(e){return"</("+e+")>"}(e),p=v(u+"$",""),f=v("^"+l,""),h=p.test(c),d=f.test(i);return d&&h?o.replace(f,"",1).replace(p,"",-1):(p=v("^"+u,""),f=v(l+"$",""),h=p.test(s),(d=f.test(s))&&h&&o.insert(s=s.replace(f,"").replace(p,"")),!s&&t&&o.insert(t),!1!==(n=m(n))&&o.trim(n[0],n[1]),o.wrap("<"+e+b(r)+">","</"+e+">"))},g.wrap=function(e,t,r,n){void 0===t&&(t=""),void 0===r&&(r={}),void 0===n&&(n=!1);var o=this,a=o.$();return a.after,a.before,!a.value&&t&&o.insert(t),!1!==(n=m(n))&&o.trim(n[0],n[1]),o.wrap("<"+e+b(r)+">","</"+e+">")};var q=d.protocol,$=g.toggle,k="[\\w:.-]+",w=function(e){return"<("+e+")(\\s(?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^/>'\"])*)?>"},y=function(e){return"</("+e+")>"};function x(e,r,n){return(!r||t("\n",r))&&(!n||"\n"===n[0])&&(!e||"\n"===e.slice(-1))}function S(e,t){return e===t.h1[1]||e===t.h2[1]||e===t.h3[1]||e===t.h4[1]||e===t.h5[1]||e===t.h6[1]||e===t.p[1]}function E(e){return!1!==e&&(c(e)?e=[e,e]:r(e)||(e=["",""]),i(e[1])||(e[1]=e[0])),e}var T={};T.blocks=function(){var e=this;return e.record(),function(e){var t=v(w("h([1-6])|p")+"$","i"),r=v("^"+y("h[1-6]|p"),"i"),n=e.$(),o=n.after,a=n.end,i=n.before,c=n.start,u=n.value,l=e.state,p=l.source.tab||l.tab||"\t",f=l.defaults||{};if(!u){var h=o.split("\n").shift(),d=i.split("\n").pop();h.trim()||d.trim()?e.select(c-s(d),a+s(h)):e.insert(f.h1[1]);var g=e.$();o=g.after,i=g.before,a=g.end,c=g.start,u=g.value}var m=i.split("\n").pop().match(/^(\s+)/),q=m&&m[1]||"";e.match([t,/[\s\S]*/,r],(function(n,o,a){var i=+(n[2]||0),c=n[3]||"",s=n[1]?f[n[1]]:["","",{}];!c&&s[2]&&(c=b(s[2])),e.replace(t,"",-1),e.replace(/\n+/g," "),e.replace(r,"",1),i?++i>6?(e.wrap(q+"<"+f.p[0]+(c||b(f.p[2]))+">","</"+f.p[0]+">"),o[0]&&!S(o[0],f)||e.insert(f.p[1])):(e.wrap(q+"<"+f["h"+i][0]+(c||b(f["h"+i][2]))+">","</"+f["h"+i][0]+">"),o[0]&&!S(o[0],f)||e.insert(f["h"+i][1])):(e.wrap(q+"<"+f.h1[0]+(c||b(f.h1[2]))+">","</"+f.h1[0]+">"),o[0]&&!S(o[0],f)||e.insert(f.h1[1])),e.replace(v("^("+y("h[1-6]|p")+")\\s*("+y(k)+")"),"$1\n"+q.replace(v("^"+p),"")+"$3",1)})),e.replace(v("^\\s*"+w("blockquote|h[1-6]|p(re)?")),""),e.replace(v(y("blockquote|h[1-6]|p(re)?")+"\\s*$"),"")}(e),e.record(),!1},T.bold=function(){var e=this,t=e.state.defaults||{},r=e.$().value;return e.record(),$.apply(e,[].concat(t.b,(!r||t.b[1]===r)&&" ")),!1},T.code=function(){var e=this;return e.record(),function(e){var t=/<(p|pre|code)(?:\s[^>]*)?>(?:\s*<code(?:\s[^>]*)?>)?$/,r=/^(?:<\/code>\s*)?<\/(p|pre|code)>/,n=e.$(),o=n.after;n.end;var a=n.before;n.start;var i=n.value,c=e.state;c.source.tab||c.tab;var s=e.state.defaults||{};!i&&x(a,i,o)?(e.trim("\n","\n"),e.wrap("<"+s.pre[0]+b(s.pre[2])+"><"+s.code[0]+b(s.code[2])+">","</"+s.code[0]+"></"+s.pre[0]+">").insert(p(s.code[1]))):e.match([t,/[\s\S]*/,r],(function(n,o,a){e.replace(t,"",-1),e.replace(r,"",1),x(n[0],o[0],a[0])||s.p[0]===a[1]||s.pre[0]===a[1]?(e.trim("\n","\n"),s.pre[0]===a[1]?(e.wrap("<"+s.p[0]+b(s.p[2])+">","</"+s.p[0]+">").insert(u(o[0])),o[0]===s.code[1]&&e.insert(s.p[1])):(e.wrap("<"+s.pre[0]+b(s.pre[2])+"><"+s.code[0]+b(s.code[2])+">","</"+s.code[0]+"></"+s.pre[0]+">").insert(p(o[0])),o[0]===s.p[1]&&e.insert(s.code[1]))):s.code[0]===a[1]?e.insert(u(o[0])):$.apply(e,[].concat(s.code,(!o||s.code[1]===o)&&" "))}))}(e),e.record(),!1},T.image=function(e,t){void 0===e&&(e="URL:");var r=this,o=r.$(),a=o.after,i=o.before,c=o.value,s=r.state,u=s.source.tab||s.tab||"\t",l=s.defaults||{},p=i.split("\n").pop().match(/^(\s+)/),f=p&&p[1]||"",h=s.source.prompt;return n(h)&&h(e,c&&/^https?:\/\/\S+$/.test(c)?c:t||q+"//").then((function(e){if(e){var t=[].concat(l.img);c&&(t[2].alt=c,r.record()),t[2].src=e,x(i,c,a)?(r.insert("").trim("\n","\n"),r.wrap(f+"<"+l.figure[0]+b(l.figure[2])+">\n"+f+u,f+"\n</"+l.figure[0]+">"),r.insert("<"+t[0]+b(t[2])+">\n"+f+u,-1),r.wrap("<"+l.figcaption[0]+b(l.figcaption[2])+">","</"+l.figcaption[0]+">").insert(l.figcaption[1])):r.trim(" ","").insert("<"+t[0]+b(t[2])+">"+(a?" ":""),-1,!0)}else r.focus()})).catch((function(e){return 0})),r.record(),!1},T.italic=function(){var e=this,t=e.state.defaults||{},r=e.$().value;return e.record(),$.apply(e,[].concat(t.i,(!r||t.i[1]===r)&&" ")),!1},T.link=function(e,r){void 0===e&&(e="URL:");var o=this,a=o.$(),i=a.after,c=a.end,l=a.before,p=a.value,h=o.state,d=h.defaults||{},g=h.source.prompt;if(n(g)){var b,m,k,y=[].concat(d.a);(m=v(w(y[0])).exec(l))?(k=!0,o.select(m.index+s(m[0]),c+i.indexOf("</"+y[0]+">")),m=/\shref=(?:"([^"]+)"|'([^']+)'|([^>\/\s]+))/.exec(m[2]),b=u((m[1]||"")+(m[2]||"")+(m[3]||""))):(m=v("^\\s*"+w(y[0])).exec(p))&&(m=/\shref=(?:"([^"]+)"|'([^']+)'|([^>\/\s]+))/.exec(m[2]),b=u((m[1]||"")+(m[2]||"")+(m[3]||""))),g(e,p&&/^https?:\/\/\S+$/.test(p)?p:b||r||q+"//").then((function(e){if(e){p&&o.record(),y[2].href=e;var r={};/[.\/?&#]/.test(e[0])||/^(data|javascript|mailto):/.test(e)||!t("://",e)||(r.rel="nofollow",r.target="_blank"),k&&$.call(o,y[0]),$.call(o,y[0],y[1],f(r,y[2]),(!p||y[1]===p)&&" ")}else o.focus()})).catch((function(e){return 0}))}return o.record(),!1},T.quote=function(){var e=this;return e.record(),function(e){var t=/<(blockquote|q)(?:\s[^>]*)?>\s*$/,r=/^\s*<\/(blockquote|q)>/,n=e.$(),o=n.after;n.end;var a=n.before;n.start;var i=n.value,c=e.state,s=c.source.tab||c.tab||"\t",u=e.state.defaults||{};x(a,i,o)?e.wrap("<"+u.blockquote[0]+b(u.blockquote[2])+">","</"+u.blockquote[0]+">").insert(u.blockquote[1]):e.match([t,/[\s\S]*/,r],(function(e,n,o){var a,i=this;i.replace(t,"",-1),i.replace(r,"",1),x(e[0],n[0],o[0])?(!1!==(a=E(u.blockquote[3]))&&i.trim(a[0],a[1]),u.blockquote[0]===o[1]?i.replace(v("(^|\\n)"+s),"$1"):(i.wrap("<"+u.blockquote[0]+b(u.blockquote[2])+">\n","\n</"+u.blockquote[0]+">"),i.replace(v("(^|\\n)"),"$1"+s))):o[0]?u.blockquote[0]===o[1]?(!1!==(a=E(u[""][3]))&&i.trim(a[0],a[1]),i.replace(v("(^|\\n)"+s),"$1")):u.q[0]===o[1]&&(!1!==(a=E(u.blockquote[3]))&&i.trim(a[0],a[1]),i.wrap("<"+u.blockquote[0]+b(u.blockquote[2])+">\n","\n</"+u.blockquote[0]+">").insert(n[0]||u.blockquote[1]),n[0]!==u.blockquote[1]&&n[0]!==u.q[1]&&i.replace(v("(^|\\n)"),"$1"+s)):(!1!==(a=E(u.q[3]))&&i.trim(a[0],a[1]),i.wrap("<"+u.q[0]+b(u.q[2])+">","</"+u.q[0]+">").insert(n[0]||u.q[1]),i.replace(v("(^|\\n)"+s),"$1"))}))}(e),e.record(),!1},T.underline=function(){var e=this,t=e.state.defaults||{},r=e.$().value;return e.record(),$.apply(e,[].concat(t.u,(!r||t.u[1]===r)&&" ")),!1};var j={defaults:{"":["","text goes here…",{}],a:["a","link text goes here…",{}],area:["area",!1,{}],b:["strong","text goes here…",{}],base:["base",!1,{href:""}],blockquote:["blockquote","quote goes here…",{}],br:["br",!1,{}],button:["button","text goes here…",{name:"",type:"submit"}],caption:["caption","table caption goes here…",{}],code:["code","code goes here…",{}],col:["col",!1,{}],em:["em","text goes here…",{}],figcaption:["figcaption","image caption goes here…",{}],figure:["figure","",{}],h1:["h1","title goes here…",{}],h2:["h2","title goes here…",{}],h3:["h3","title goes here…",{}],h4:["h4","title goes here…",{}],h5:["h5","title goes here…",{}],h6:["h6","title goes here…",{}],hr:["hr",!1,{}],i:["em","text goes here…",{}],img:["img",!1,{alt:"",src:""}],input:["input",!1,{name:"",type:"text"}],li:["li","list item goes here…",{}],link:["link",!1,{href:""}],meta:["meta",!1,{}],ol:["ol","",{}],option:["option","option goes here…",{}],p:["p","paragraph goes here…",{}],param:["param",!1,{name:""}],pre:["pre","text goes here…",{}],q:["q","quote goes here…",{}],script:["script","code goes here…",{}],select:["select","",{name:""}],source:["source",!1,{src:""}],strong:["strong","text goes here…",{}],style:["style","code goes here…",{}],td:["td","data goes here…",{}],textarea:["textarea","value goes here…",{name:""}],th:["th","title goes here…",{}],tr:["tr","",{}],track:["track",!1,{}],u:["u","text goes here…",{}],ul:["ul","",{},"\n"],wbr:["wbr",!1,{}]},source:{type:"HTML"}};e.canKeyDown=function(e,t){var r=t.state,n=r.source.tab||r.tab||"\t",o=r.defaults||{},a=e.key,i=e.queue;if(i.Control){var c=t.$(),u=c.after,l=c.before,p=c.end,f=c.start;c.value;var h=u.split("\n").shift(),d=l.split("\n").pop(),g=d.match(/^(\s+)/),m=g&&g[1]||"";if("Enter"===a){var q=h.match(v(y(k)+"\\s*$","")),x=o[q&&q[1]||"p"]||o.p;return x[3]=["\n"+m,"\n"+(!i.Shift&&u&&v("^\\s*"+y(k)).test(u.split("\n")[1]||"")?m.replace(v("^"+n),""):m)],t.select(i.Shift?f-s(d):p+s(h)),$.apply(t,x),t.record(),!1}}if(i.Alt||i.Control)return!0;if(">"===a){var S,E=t.$(),T=E.after,j=E.before,O=E.end,A=(j.split("\n").pop()+">").match(v(w(k)+"$","")),L=o[S=A&&A[1]||""];return!S||(L?!1!==L[1]?(">"===T[0]?t.select(O+1):t.insert(">",-1),t.insert("</"+S+">",1).insert(L[1])):">"===T[0]?t.insert(" /",-1).select(O+3):t.insert(" />",-1):(">"===T[0]?t.select(O+1):t.insert(">",-1),t.insert("</"+S+">",1)),t.record(),!1)}if("Enter"===a){var R,M,_=t.$(),C=_.after,H=_.before,U=_.value,D=C.split("\n").shift(),K=H.split("\n").pop(),P=K.match(/^(\s+)/),W=P&&P[1]||"",z=["li","option","p","td","th"],B=["pre","script","style"];if(R=K.match(v(w(k)+"$",""))){var F=o[R[1]];if(F&&!1===F[1])return t.insert("\n"+W,-1).record(),!1}if(i.Shift){var G=o.br;return t.insert("<"+G[0]+b(G[2])+">"+(!1===G[1]?"":G[1]+"</"+G[0]+">")+"\n",-1).record(),!1}if(C&&H){for(var I=0,J=s(z);I<J;++I)if(v("^"+y(M=z[I]),"").test(D)&&(R=K.match(v("^\\s*"+w(M),""))))return R[0]===K?(o[M]&&U&&o[M][1]===U?t.insert("").wrap("\n"+W+n,"\n"+W):$.call(t,M),t.record(),!1):(t.insert("</"+M+">\n"+W+"<"+M+(R[2]||"")+">",-1).insert(o[M]&&o[M][1]||"").record(),!1);for(var N=0,Q=s(B);N<Q;++N)if(v("^"+y(M=B[N]),"").test(D)&&v(w(M)+"$","").test(K))return t.wrap("\n"+W,"\n"+W).insert(o[M]&&o[M][1]||"").record(),!1;for(var V=1;V<7;++V)if(D.startsWith("</"+o["h"+V][0]+">")&&K.match(v("^\\s*"+w(o["h"+V][0]),"")))return o["h"+V]&&U&&o["h"+V][1]===U?t.insert("").wrap("\n"+W+n,"\n"+W):t.insert("</"+o["h"+V][0]+">\n"+W+"<"+o.p[0]+">",-1).replace(v("^"+y(o["h"+V][0])),"</"+o.p[0]+">",1).insert(o.p[1]),t.record(),!1}}return!0},e.commands=T,e.state=j,Object.defineProperty(e,"__esModule",{value:!0})}));