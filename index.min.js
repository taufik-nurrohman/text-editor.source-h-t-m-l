/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2021 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).TE=e.TE||{},e.TE.SourceHTML={}))}(this,(function(e){"use strict";var t=function(e){return Array.isArray(e)},r=function(e){return"function"==typeof e},n=function(e,t){return e&&o(t)&&e instanceof t},o=function(e){return function(e){return void 0!==e}(e)&&!function(e){return null===e}(e)},i=function(e){return"string"==typeof e},s=function(e){return e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;")},c=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return Object.assign.apply(Object,[{}].concat(t))},a=function e(r){if(t(r))return r.map((function(t){return e(r)}));if(function(e,t){return void 0===t&&(t=!0),"object"==typeof e&&(!t||n(e,Object))}(r)){for(var o in r)r[o]=e(r[o]);return r}return!1===r?"false":null===r?"null":!0===r?"true":""+r},l=function(e){return e.length},p=window,u=function(e,t){return function(e){return n(e,RegExp)}(e)?e:(e=e.replace(/\//g,"\\/"),RegExp(e,o(t)?t:"g"))},f={};f.toggle=function(e,t,r,n){void 0===t&&(t=""),void 0===r&&(r={}),void 0===n&&(n=!1);var o=this,c=o.$(),l=c.after,p=c.before,f=c.value,h=function(e){return"<("+e+")(\\s(?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^/>'\"])*)?>"}(e),g=function(e){return"</("+e+")>"}(e),d=u(h+"$",""),m=u("^"+g,""),b=d.test(p),y=m.test(l);return y&&b?o.replace(m,"",1).replace(d,"",-1):(d=u("^"+h,""),m=u(g+"$",""),b=d.test(f),(y=m.test(f))&&b&&o.insert(f=f.replace(m,"").replace(d,"")),!f&&t&&o.insert(t),!1!==n&&(!0===n&&(n=["",""]),i(n)&&(n=[n,n]),o.trim(n[0],n[1]||n[0])),o.wrap("<"+e+function(e){var t,r="";for(t in e)r+=" "+t+'="'+s(a(e[t]))+'"';return r}(r)+">","</"+e+">"))};const{toggle:h}=f;let g="[\\w:.-]+",d=e=>"<("+e+")(\\s(?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^/>'\"])*)?>",m=e=>"</("+e+")>";function b(e){if(!e)return"";let t,r="";for(t in e)r+=" "+t+'="'+s(a(e[t]))+'"';return r}function y(e){return!1!==e&&(i(e)?e=[e,e]:t(e)||(e=["",""]),o(e[1])||(e[1]=e[0])),e}function q(e){let{before:t}=e.$(),r="HTML";u(d("script"),"").test(t)&&!u(m("script"),"").test(t)?r="JS":u(d("style"),"").test(t)&&!u(m("style"),"").test(t)&&(r="CSS"),e.state.source.type=r}const w={source:{type:"HTML"},sourceHTML:{elements:{"":["","text goes here…",{},""],a:["a","link text goes here…",{}],area:["area",!1,{}],b:["strong","text goes here…",{}],base:["base",!1,{href:""},"\n"],blockquote:["blockquote","",{},"\n"],br:["br",!1,{},["","\n"]],button:["button","text goes here…",{name:"",type:"submit"}," "],caption:["caption","caption goes here…",{},"\n"],code:["code","code goes here…",{}," "],col:["col",!1,{},"\n"],em:["em","text goes here…",{}],figcaption:["figcaption","caption goes here…",{},"\n"],figure:["figure","",{},"\n"],h1:["h1","title goes here…",{},"\n"],h2:["h2","title goes here…",{},"\n"],h3:["h3","title goes here…",{},"\n"],h4:["h4","title goes here…",{},"\n"],h5:["h5","title goes here…",{},"\n"],h6:["h6","title goes here…",{},"\n"],hr:["hr",!1,{},"\n"],i:["em","text goes here…",{}],img:["img",!1,{alt:"",src:""}," "],input:["input",!1,{name:"",type:"text"}," "],li:["li","list item goes here…",{},"\n"],link:["link",!1,{href:""},"\n"],meta:["meta",!1,{},"\n"],ol:["ol","",{},"\n"],option:["option","option goes here…",{},"\n"],p:["p","paragraph goes here…",{},"\n"],param:["param",!1,{name:""},"\n"],pre:["pre","text goes here…",{},"\n"],q:["q","quote goes here…",{}," "],script:["script","",{},"\n"],select:["select","",{name:""}," "],source:["source",!1,{src:""},"\n"],strong:["strong","text goes here…",{}],style:["style","",{},"\n"],td:["td","data goes here…",{},"\n"],textarea:["textarea","text goes here…",{name:""}," "],th:["th","title goes here…",{},"\n"],tr:["tr","",{},"\n"],track:["track",!1,{},"\n"],u:["u","text goes here…",{}],ul:["ul","",{},"\n"],wbr:["wbr",!1,{},["","\n"]]}}};e.canKeyDown=function(e,{a:t,c:n,s:o},i){let s=i.state,a=s.sourceHTML.tab||s.source.tab||s.tab||"\t",p=s.sourceHTML.elements||{},f=s.source.prompt;if(q(i),n){let{after:t,before:n,end:s,start:d,value:q}=i.$(),w=t.split("\n").shift(),x=n.split("\n").pop(),$=x.match(/^(\s+)/),k=$&&$[1]||"";if("b"===e)return h.apply(i,p.b),!1;if("g"===e){if(r(f)){let e=f("URL:",q&&/^https?:\/\/\S+$/.test(q)?q:"http://"),r=p.img;if(e){q&&(r[2].alt=q,i.record());let o=r[3]||!1;!1!==(o=y(o))&&i.trim(o[0],""),r[2].src=e,t&&"\n"!==t[0]||n&&"\n"!==n.slice(-1)?i.insert("<"+r[0]+b(r[2])+">"+(!1!==o?o[1]:""),-1,!0):(o=p.figure[3]||!1,!1!==(o=y(o))&&i.trim(o[0],o[1]),i.insert(""),i.wrap(k+"<"+p.figure[0]+b(p.figure[2])+">\n"+k+a,k+"\n</"+p.figure[0]+">"),i.insert("<"+r[0]+b(r[2])+">\n"+k+a,-1),i.wrap("<"+p.figcaption[0]+b(p.figcaption[2])+">","</"+p.figcaption[0]+">").insert(p.figcaption[1]))}}return i.record(),!1}if("h"===e)return function(e){let t=/<(?:h([1-6])|p)(\s[^>]*)?>$/,r=/^<\/(?:h[1-6]|p)>/;e.match([t,/.*/,r],(function(n,o,i){let s=this,c=+(n[1]||0),a=n[2]||"",l=e.state.sourceHTML.elements||{},p=n[0]?l[n[0].slice(1,-1).split(/\s/)[0]]:["","",{},["",""]];!a&&p[2]&&(a=b(p[2])),s.replace(t,"",-1),s.replace(r,"",1);let u=p[3];!1!==(u=y(u))&&s.trim(u[0],u[1]),c?(++c,c>6?(s.wrap("<"+l.p[0]+(a||b(l.p[2]))+">","</"+l.p[0]+">"),o[0]&&o[0]!==l.h6[1]||s.insert(l.p[1])):(s.wrap("<"+l["h"+c][0]+(a||b(l["h"+c][2]))+">","</"+l["h"+c][0]+">"),o[0]&&o[0]!==l.p[1]||s.insert(l["h"+c][1]))):(s.wrap("<"+l.h1[0]+(a||b(l.h1[2]))+">","</"+l.h1[0]+">"),o[0]&&o[0]!==l.p[1]||s.insert(l.h1[1]))}))}(i),i.record(),!1;if("i"===e)return h.apply(i,p.i),!1;if("k"===e)return function(e){let t=/<(?:pre|code)(?:\s[^>]*)?>(?:\s*<code(?:\s[^>]*)?>)?$/,r=/^(?:<\/code>\s*)?<\/(?:pre|code)>/;e.match([t,/.*/,r],(function(n,o,i){let s,c=this,a=e.state.sourceHTML.elements;c.replace(t,"",-1),c.replace(r,"",1),i[0]?/^(?:<\/code>\s*)?<\/pre>/.test(i[0])?(s=a[""][3],!1!==(s=y(s))&&c.trim(s[0],s[1]),c.insert(o[0].replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"))):i[0].slice(0,7)==="</"+a.code[0]+">"&&(s=a.pre[3],!1!==(s=y(s))&&c.trim(s[0],s[1]),c.wrap("<"+a.pre[0]+b(a.pre[2])+"><"+a.code[0]+b(a.code[2])+">","</"+a.code[0]+"></"+a.pre[0]+">")):(s=a.code[3],!1!==(s=y(s))&&c.trim(s[0],s[1]),c.wrap("<"+a.code[0]+b(a.code[2])+">","</"+a.code[0]+">").insert((o[0]||a.code[1]).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")))}))}(i),i.record(),!1;if("l"===e){if(r(f)){let e=f("URL:",q&&/^https?:\/\/\S+$/.test(q)?q:"http://"),t=p.a;if(q&&i.record(),e){t[2].href=e;let r={};/[.\/?&#]/.test(e[0])||/^(data|javascript|mailto):/.test(e)||-1===e.indexOf("://")||(r.rel="nofollow",r.target="_blank"),h.call(i,t[0],t[1],c(r,t[2]),t[3])}}return i.record(),!1}if("q"===e)return function(e){let t=/<(blockquote|q)(?:\s[^>]*)?>\s*$/,r=/^\s*<\/(blockquote|q)>/;e.match([t,/.*/,r],(function(n,o,i){let s,c=this,a=e.state,l=a.sourceHTML.tab||a.source.tab||a.tab||"\t",p=e.state.sourceHTML.elements||{};c.replace(t,"",-1),c.replace(r,"",1),i[0]?p.blockquote[0]===i[1]?!1!==(s=y(p[""][3]))&&c.trim(s[0],s[1]):p.q[0]===i[1]&&(!1!==(s=y(p.blockquote[3]))&&c.trim(s[0],s[1]),c.wrap("<"+p.blockquote[0]+b(p.blockquote[2])+">\n","\n</"+p.blockquote[0]+">").insert(o[0]||p.blockquote[1]),c.replace(u("(^|\\n)"),"$1"+l)):(!1!==(s=y(p.q[3]))&&c.trim(s[0],s[1]),c.wrap("<"+p.q[0]+b(p.q[2])+">","</"+p.q[0]+">").insert(o[0]||p.q[1]),c.replace(u("(^|\\n)"+l),"$1"))}))}(i),i.record(),!1;if("u"===e)return h.apply(i,p.u),!1;if("Enter"===e){let e=w.match(u(m(g)+"\\s*$","")),t=p[e&&e[1]||"p"]||p.p;return t[3]=["\n"+k,"\n"+k],i.select(o?d-l(x):s+l(w)),h.apply(i,t),i.record(),!1}}if(t||n)return!0;if(">"===e){let e,{after:t,before:r,end:n}=i.$(),o=(r.split("\n").pop()+">").match(u(d(g)+"$","")),s=p[e=o&&o[1]||""];return!e||(s?!1!==s[1]?(">"===t[0]?i.select(n+1):i.insert(">",-1),i.insert("</"+e+">",1).insert(s[1])):">"===t[0]?i.insert(" /",-1).select(n+3):i.insert(" />",-1):(">"===t[0]?i.select(n+1):i.insert(">",-1),i.insert("</"+e+">",1)),i.record(),!1)}if("Enter"===e){let e,t,{after:r,before:n,value:o}=i.$(),s=r.split("\n").shift(),c=n.split("\n").pop(),f=c.match(/^(\s+)/),b=f&&f[1]||"",y=["li","option","p","td","th"],q=["script","style"];if(e=c.match(u(d(g)+"$",""))){let t=p[e[1]];if(t&&!1===t[1])return i.insert("\n"+b,-1).record(),!1}if(r&&n){for(let r=0,n=l(y);r<n;++r)if(t=y[r],u("^"+m(t),"").test(s)&&(e=c.match(u("^\\s*"+d(t),""))))return e[0]===c?(p[t]&&o&&p[t][1]===o?i.insert("").wrap("\n"+b+a,"\n"+b):h.call(i,t),i.record(),!1):(i.insert("</"+t+">\n"+b+"<"+t+(e[2]||"")+">",-1).insert(p[t]&&p[t][1]||"").record(),!1);for(let e=0,r=l(q);e<r;++e)if(t=q[e],u("^"+m(t),"").test(s)&&u(d(t)+"$","").test(c))return i.wrap("\n"+b,"\n"+b).insert(p[t]&&p[t][1]||"").record(),!1;for(let e=1;e<7;++e)if(s.startsWith("</"+p["h"+e][0]+">")&&c.match(u("^\\s*"+d(p["h"+e][0]),"")))return p["h"+e]&&o&&p["h"+e][1]===o?i.insert("").wrap("\n"+b+a,"\n"+b):i.insert("</"+p["h"+e][0]+">\n"+b+"<"+p.p[0]+">",-1).replace(u("^"+m(p["h"+e][0])),"</"+p.p[0]+">",1).insert(p.p[1]),i.record(),!1}}return!0},e.canMouseDown=function(e,{a:t,c:r,s:n},o){return p.setTimeout((()=>q(o)),1),!0},e.state=w}));