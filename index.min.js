/*!
 *
 * The MIT License (MIT)

 * Copyright © 2021 Taufik Nurrohman <https://github.com/taufik-nurrohman>

 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:

 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.

 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).TE=e.TE||{},e.TE.SourceHTML={}))}(this,(function(e){"use strict";var t=function(e){return"function"==typeof e},r=function(e,t){return e&&n(t)&&e instanceof t},n=function(e){return function(e){return void 0!==e}(e)&&!function(e){return null===e}(e)},o=function(e){return"string"==typeof e},i=function(e){return e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;")},c=function e(t){if(function(e){return Array.isArray(e)}(t))return t.map((function(r){return e(t)}));if(function(e,t){return void 0===t&&(t=!0),"object"==typeof e&&(!t||r(e,Object))}(t)){for(var n in t)t[n]=e(t[n]);return t}return!1===t?"false":null===t?"null":!0===t?"true":""+t},p=function(e){return e.length},l=window,s=function(e,t){return function(e){return r(e,RegExp)}(e)?e:(e=e.replace(/\//g,"\\/"),RegExp(e,n(t)?t:"g"))},a={};a.toggle=function(e,t,r,n){void 0===t&&(t=""),void 0===r&&(r={}),void 0===n&&(n=!1);var p=this,l=p.$(),a=l.after,u=l.before,f=l.value,h=function(e){return"<("+e+")(\\s(?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^/>'\"])*)?>"}(e),g=function(e){return"</("+e+")>"}(e),d=s(h+"$",""),m=s("^"+g,""),b=d.test(u),$=m.test(a);return $&&b?p.replace(m,"",1).replace(d,"",-1):(d=s("^"+h,""),m=s(g+"$",""),b=d.test(f),($=m.test(f))&&b&&p.insert(f=f.replace(m,"").replace(d,"")),!f&&t&&p.insert(t),!1!==n&&(n=o(n)?[n,n]:["",""],p.trim(n[0],n[1]||n[0])),p.wrap("<"+e+function(e){if(!e)return"";var t,r="";for(t in e)r+=" "+t+'="'+i(c(e[t]))+'"';return r}(r)+">","</"+e+">"))};const u={sourceHTML:{input:(e,t)=>l.prompt(e,t),object:{a:["a","link text goes here…",{}],area:["area",!1,{}],b:["strong","text goes here…",{}],base:["base",!1,{},"\n"],blockquote:["blockquote","",{},"\n"],br:["br",!1,{},["","\n"]],code:["code","code goes here…",{}," "],col:["col",!1,{},"\n"],em:["em","text goes here…",{}],h1:["h1","title goes here…",{},"\n"],h2:["h2","title goes here…",{},"\n"],h3:["h3","title goes here…",{},"\n"],h4:["h4","title goes here…",{},"\n"],h5:["h5","title goes here…",{},"\n"],h6:["h6","title goes here…",{},"\n"],hr:["hr",!1,{},"\n"],i:["em","text goes here…",{}],img:["img",!1,{alt:""}," "],input:["input",!1,{}," "],li:["li","",{},"\n"],link:["link",!1,{},"\n"],meta:["meta",!1,{},"\n"],ol:["ol","",{},"\n"],option:["option","option goes here…",{},"\n"],p:["p","paragraph goes here…",{},"\n"],param:["param",!1,{},"\n"],pre:["pre","text goes here…",{},"\n"],source:["source",!1,{},"\n"],strong:["strong","text goes here…",{}],td:["td","",{},"\n"],th:["th","",{},"\n"],tr:["tr","",{},"\n"],track:["track",!1,{},"\n"],u:["u","text goes here…",{}],ul:["ul","",{},"\n"],wbr:["wbr",!1,{},["","\n"]]}}},{toggle:f}=a;let h="[\\w:.-]+",g=e=>"<("+e+")(\\s(?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^/>'\"])*)?>",d=e=>"</("+e+")>";function m(e){if(!e)return"";let t,r="";for(t in e)r+=" "+t+'="'+i(c(e[t]))+'"';return r}const b=u;e.canKeyDown=function(e,{a:r,c:n,s:i},c){let l=c.state,a=l.sourceHTML.object||{};l.sourceHTML.tab||l.tab;let u=l.sourceHTML.input;if(n){if("b"===e)return f.apply(c,a.b),!1;if("g"===e){if(t(u)){let e=c.$().value,t=u("URL:",e&&/^https?:\/\/\S+$/.test(e)?e:"http://");if(a.img[2].src=t,e&&(a.img[2].alt=e,c.record()),t){let r=a.img[3]||!1;!1!==r&&(r=o(r)?[r,r]:["",""]),c.trim(r[0],""),c.insert("<"+a.img[0]+' alt="'+e+'" src="'+t+'">'+(r[1]||r[0]),-1,!0)}}return c.record(),!1}if("h"===e)return function(e){let t=/<(?:h([1-6])|p)(\s[^>]*)?>$/,r=/^<\/(?:h[1-6]|p)>/;e.match([t,/.*/,r],(function(n,i,c){let p=this,l=+(n[1]||0),s=n[2]||"",a=e.state.sourceHTML.object||{},u=n[0]?a[n[0].slice(1,-1).split(/\s/)[0]]:["","",{},["",""]];!s&&u[2]&&(s=m(u[2])),p.replace(t,"",-1),p.replace(r,"",1);let f=u[3];!1!==f&&(f=o(f)?[f,f]:["",""],p.trim(f[0],f[1]||f[0])),l?(++l,l>6?(p.wrap("<"+a.p[0]+(s||m(a.p[2]))+">","</"+a.p[0]+">"),i[0]&&i[0]!==a.h6[1]||p.insert(a.p[1])):(p.wrap("<"+a["h"+l][0]+(s||m(a["h"+l][2]))+">","</"+a["h"+l][0]+">"),i[0]&&i[0]!==a.p[1]||p.insert(a["h"+l][1]))):(p.wrap("<"+a.h1[0]+(s||m(a.h1[2]))+">","</"+a.h1[0]+">"),i[0]&&i[0]!==a.p[1]||p.insert(a.h1[1]))}))}(c),c.record(),!1;if("i"===e)return f.apply(c,a.i),!1;if("k"===e)return function(e){let t=/<(?:pre|code)(?:\s[^>]*)?>(?:\s*<code(?:\s[^>]*)?>)?$/,r=/^(?:<\/code>\s*)?<\/(?:pre|code)>/;e.match([t,/.*/,r],(function(n,i,c){let p,l=this,s=e.state.sourceHTML.object,a=m(s.code[2]),u=m(s.pre[2]);l.replace(t,"",-1),l.replace(r,"",1),c[0]?/^(?:<\/code>\s*)?<\/pre>/.test(c[0])?l.trim("","").insert(e.$().value.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")):c[0].slice(0,7)==="</"+s.code[0]+">"&&(p=s.pre[3],!1!==p&&(p=o(p)?[p,p]:["",""],l.trim(p[0],p[1]||p[0])),l.wrap("<"+s.pre[0]+u+"><"+s.code[0]+a+">","</"+s.code[0]+"></"+s.pre[0]+">")):(p=s.code[3],!1!==p&&(p=o(p)?[p,p]:["",""],l.trim(p[0],p[1]||p[0])),l.wrap("<"+s.code[0]+a+">","</"+s.code[0]+">").insert((e.$().value||s.code[1]).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")))}))}(c),c.record(),!1;if("l"===e){if(t(u)){let e=c.$().value,t=u("URL:",e&&/^https?:\/\/\S+$/.test(e)?e:"http://");a.a[2].href=t,e&&c.record(),t&&f.apply(c,a.a)}return c.record(),!1}if("u"===e)return f.apply(c,a.u),!1;if("Enter"===e){let e,{after:t,before:r,end:n,start:o,value:l}=c.$(),u=t.split("\n").shift(),m=r.split("\n").pop(),b=m.match(/^(\s+)/),$=b&&b[1]||"";e=u.match(s(d(h)+"\\s*$",""));let v=e&&e[1]||a.p[0];return i?(c.select(o-p(m)),f.apply(c,a[v]||a.p),c.replace(s("^("+d(h)+")\\s*(.)",""),"$1\n"+$+"$3",1),c.replace(s("(^|\\n)\\s*("+g(h)+")$",""),"$1"+$+"$2",-1),c.record(),!1):(c.select(n+p(u)),f.apply(c,a[v]||a.p),c.replace(s("(.)\\s*("+g(h)+")$",""),"$1\n"+$+"$2",-1),c.record(),!1)}}if(r||n)return!0;if("Enter"===e){let e,{after:t,before:r,value:n}=c.$(),o=t.split("\n").shift(),i=r.split("\n").pop(),l=i.match(/^(\s+)/),u=l&&l[1]||"";if(!n&&t&&r){let t,r=["li","option","p","td","th"];for(let n=0,l=p(r);n<l;++n)if((t=a[r[n]])&&(t=t[0],"</"+t+">"===o&&(e=i.match(s("^\\s*"+g(t),"")))))return e[0]===i?(c.replace(s(g(t)+"$",""),"",-1),c.replace(s("^"+d(t),""),"",1),c.record(),!1):(c.insert("</"+t+">\n"+u+"<"+t+(e[2]||"")+">",-1).record(),!1);for(let e=1;e<7;++e)if("</"+a["h"+e][0]+">"===o&&i.match(s("^\\s*"+g(a["h"+e][0]),"")))return c.insert("</"+a["h"+e][0]+">\n"+u+"<"+a.p[0]+">",-1).replace(s("^"+d(a["h"+e][0])),"</"+a.p[0]+">",1).record(),!1}}return!0},e.state=b}));