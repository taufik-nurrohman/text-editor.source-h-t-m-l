/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2023 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).TE=e.TE||{},e.TE.SourceHTML={}))}(this,(function(e){"use strict";var t=function(e){return Array.isArray(e)},r=function(e){return"function"==typeof e},n=function(e,t){return e&&i(t)&&e instanceof t},o=function(e,t){return void 0===t&&(t=!0),"object"==typeof e&&(!t||n(e,Object))},i=function(e){return function(e){return void 0!==e}(e)&&!function(e){return null===e}(e)},a=function(e){return"string"==typeof e},c=function(e){return e.length},s=function(e,t){return void 0===t&&(t=!0),e=e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),t&&(e=e.replace(/&apos;/g,"'").replace(/&quot;/g,'"')),e},u=function(e){return Object.keys(e)},l=function(e,t){return e=e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;"),t&&(e=e.replace(/'/g,"&apos;").replace(/"/g,"&quot;")),e},p=function e(){for(var r=arguments.length,n=Array(r),a=0;a<r;a++)n[a]=arguments[a];for(var s,u=n.shift(),l=0,p=c(n);l<p;++l)for(var f in n[l])if(i(u[f]))if(t(u[f])&&t(n[l][f])){u[f]=[].concat(u[f]);for(var h=0,d=c(n[l][f]);h<d;++h)s=n[l][f][h],-1===u[f].indexOf(s)&&u[f].push(n[l][f][h])}else o(u[f])&&o(n[l][f])?u[f]=e({},u[f],n[l][f]):u[f]=n[l][f];else u[f]=n[l][f];return u},f=function e(r){if(t(r))return r.map((function(t){return e(r)}));if(o(r)){for(var n in r)r[n]=e(r[n]);return r}return!1===r?"false":null===r?"null":!0===r?"true":""+r},h=window.location,d=function(e,t){return function(e){return n(e,RegExp)}(e)?e:(e=e.replace(/\//g,"\\/"),RegExp(e,i(t)?t:"g"))},g={};function v(e){if(!e)return"";e=u(e).sort().reduce((function(t,r){return t[r]=e[r],t}),{});var t,r,n="";for(t in e)!1!==(r=e[t])&&null!==r&&(n+=" "+t,!0!==r&&(n+='="'+l(f(r),!0)+'"'));return n}function b(e){return!1!==e&&(a(e)?e=[e,e]:t(e)||(e=["",""]),i(e[1])||(e[1]=e[0])),e}g.insert=function(e,t,r,n){void 0===t&&(t=""),void 0===r&&(r={}),void 0===n&&(n=!1);return!1!==(n=b(n))&&this.trim(n[0],""),this.insert("<"+e+v(r)+(!1!==t?">"+t+"</"+e+">":" />")+(!1!==n?n[1]:""),-1,!0)},g.toggle=function(e,t,r,n){void 0===t&&(t=""),void 0===r&&(r={}),void 0===n&&(n=!1);var o=this,i=o.$(),a=i.after,c=i.before,s=i.value,u=function(e){return"<("+e+")(\\s(?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^/>'\"])*)?>"}(e),l=function(e){return"</("+e+")>"}(e),p=d(u+"$",""),f=d("^"+l,""),h=p.test(c),g=f.test(a);return g&&h?o.replace(f,"",1).replace(p,"",-1):(p=d("^"+u,""),f=d(l+"$",""),h=p.test(s),(g=f.test(s))&&h&&o.insert(s=s.replace(f,"").replace(p,"")),!s&&t&&o.insert(t),!1!==(n=b(n))&&o.trim(n[0],n[1]),o.wrap("<"+e+v(r)+">","</"+e+">"))},g.wrap=function(e,t,r,n){void 0===t&&(t=""),void 0===r&&(r={}),void 0===n&&(n=!1);var o=this,i=o.$();return i.after,i.before,!i.value&&t&&o.insert(t),!1!==(n=b(n))&&o.trim(n[0],n[1]),o.wrap("<"+e+v(r)+">","</"+e+">")};var m=h.protocol,q=g.toggle,k="[\\w:.-]+",$=function(e){return"<("+e+")(\\s(?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^/>'\"])*)?>"},w=function(e){return"</("+e+")>"};function y(e){return!1!==e&&(a(e)?e=[e,e]:t(e)||(e=["",""]),i(e[1])||(e[1]=e[0])),e}var x={};x.blocks=function(){var e=this;return e.record(),function(e){var t=/<(?:h([1-6])|p)(\s[^>]*)?>$/,r=/^<\/(?:h[1-6]|p)>/,n=e.$(),o=n.after,i=n.end,a=n.before,s=n.start,u=n.value,l=e.state,p=l.source.tab||l.tab||"\t",f=l.defaults||{};if(!u){var h=o.split("\n").shift(),g=a.split("\n").pop();h.trim()||g.trim()?e.select(s-c(g),i+c(h)):e.insert(f.h1[1])}var b=a.split("\n").pop().match(/^(\s+)/),m=b&&b[1]||"";e.match([t,/.*/,r],(function(e,n,o){var i=this,a=+(e[1]||0),c=e[2]||"",s=e[0]?f[e[0].slice(1,-1).split(/\s/)[0]]:["","",{}];!c&&s[2]&&(c=v(s[2])),i.replace(t,"",-1),i.replace(/\n+/g," "),i.replace(r,"",1);var u=s[3]||f.h1[3];!1!==(u=y(u))&&i.trim(u[0],u[1]),a?++a>6?(i.wrap(m+"<"+f.p[0]+(c||v(f.p[2]))+">","</"+f.p[0]+">"),n[0]&&n[0]!==f.h1[1]&&n[0]!==f.h2[1]&&n[0]!==f.h3[1]&&n[0]!==f.h4[1]&&n[0]!==f.h5[1]&&n[0]!==f.h6[1]&&n[0]!==f.p[1]||i.insert(f.p[1])):(i.wrap(m+"<"+f["h"+a][0]+(c||v(f["h"+a][2]))+">","</"+f["h"+a][0]+">"),n[0]&&n[0]!==f.h1[1]&&n[0]!==f.h2[1]&&n[0]!==f.h3[1]&&n[0]!==f.h4[1]&&n[0]!==f.h5[1]&&n[0]!==f.h6[1]&&n[0]!==f.p[1]||i.insert(f["h"+a][1])):(i.wrap(m+"<"+f.h1[0]+(c||v(f.h1[2]))+">","</"+f.h1[0]+">"),n[0]&&n[0]!==f.h1[1]&&n[0]!==f.h2[1]&&n[0]!==f.h3[1]&&n[0]!==f.h4[1]&&n[0]!==f.h5[1]&&n[0]!==f.h6[1]&&n[0]!==f.p[1]||i.insert(f.h1[1])),i.replace(d("^("+w("h[1-6]|p")+")\\s*("+w(k)+")"),"$1\n"+m.replace(d("^"+p),"")+"$3",1)})),e.replace(d("^\\s*"+$("blockquote|h[1-6]|p(re)?")),""),e.replace(d(w("blockquote|h[1-6]|p(re)?")+"\\s*$"),"")}(e),e.record(),!1},x.bold=function(){var e=this,t=e.state.defaults||{};return e.record(),q.apply(e,t.b),!1},x.code=function(){var e=this;return e.record(),function(e){var t=/<(pre|code)(?:\s[^>]*)?>(?:\s*<code(?:\s[^>]*)?>)?$/,r=/^(?:<\/code>\s*)?<\/(pre|code)>/,n=e.$(),o=n.after;n.end;var i=n.before;n.start;var a=n.value,c=e.state;c.source.tab||c.tab;var u=e.state.defaults||{};a||o&&"\n"!==o[0]||i&&"\n"!==i.slice(-1)?e.match([t,/[\s\S]*/,r],(function(e,n,o){var i,a=this;a.replace(t,"",-1),a.replace(r,"",1),!n[0]||!/\n/.test(n[0])&&(o[0]&&"\n"!==o[0][0]||e[0]&&"\n"!==e[0].slice(-1))?o[0]?/^(?:<\/code>\s*)?<\/pre>/.test(o[0])?(!1!==(i=y(i=u[""][3]))&&a.trim(i[0],i[1]),a.insert(s(n[0]))):o[0].slice(0,7)==="</"+u.code[0]+">"&&(!1!==(i=y(i=u.pre[3]))&&a.trim(i[0],i[1]),a.wrap("<"+u.pre[0]+v(u.pre[2])+"><"+u.code[0]+v(u.code[2])+">","</"+u.code[0]+"></"+u.pre[0]+">")):(!1!==(i=y(i=u.code[3]))&&a.trim(i[0],i[1]),a.wrap("<"+u.code[0]+v(u.code[2])+">","</"+u.code[0]+">").insert(l(n[0]||u.code[1]))):(!1!==(i=y(u.pre[3]))&&a.trim(i[0],i[1]),u.pre[0]===o[1]?a.insert(s(n[0])):a.wrap("<"+u.pre[0]+v(u.pre[2])+"><"+u.code[0]+v(u.code[2])+">","</"+u.code[0]+"></"+u.pre[0]+">").insert(l(n[0])))})):e.wrap("<"+u.pre[0]+v(u.pre[2])+"><"+u.code[0]+v(u.code[2])+">","</"+u.code[0]+"></"+u.pre[0]+">").insert(l(u.code[1]))}(e),e.record(),!1},x.image=function(e,t){void 0===e&&(e="URL:");var n=this,o=n.$(),i=o.after,a=o.before,c=o.value,s=n.state,u=s.source.tab||s.tab||"\t",l=s.defaults||{},p=a.split("\n").pop().match(/^(\s+)/),f=p&&p[1]||"",h=s.source.prompt;return r(h)&&h(e,c&&/^https?:\/\/\S+$/.test(c)?c:t||m+"//").then((function(e){if(e){var t=l.img;c&&(t[2].alt=c,n.record());var r=t[3]||!1;!1!==(r=y(r))&&n.trim(r[0],""),t[2].src=e,i&&"\n"!==i[0]||a&&"\n"!==a.slice(-1)?n.insert("<"+t[0]+v(t[2])+">"+(!1!==r?r[1]:""),-1,!0):(!1!==(r=y(r=l.figure[3]||!1))&&n.trim(r[0],r[1]),n.insert(""),n.wrap(f+"<"+l.figure[0]+v(l.figure[2])+">\n"+f+u,f+"\n</"+l.figure[0]+">"),n.insert("<"+t[0]+v(t[2])+">\n"+f+u,-1),n.wrap("<"+l.figcaption[0]+v(l.figcaption[2])+">","</"+l.figcaption[0]+">").insert(l.figcaption[1]))}else n.focus()})).catch((function(e){return 0})),n.record(),!1},x.italic=function(){var e=this,t=e.state.defaults||{};return e.record(),q.apply(e,t.i),!1},x.link=function(e,t){void 0===e&&(e="URL:");var n=this,o=n.$(),i=o.before,a=o.value,c=n.state,u=c.defaults||{},l=c.source.prompt;if(r(l)){var f,h,g,v=u.a;(h=d($(v[0])).exec(i))?(g=!0,h=/\shref=(?:"([^"]+)"|'([^']+)'|([^>\/\s]+))/.exec(h[2]),f=s((h[1]||"")+(h[2]||"")+(h[3]||""))):(h=d("^\\s*"+$(v[0])).exec(a))&&(h=/\shref=(?:"([^"]+)"|'([^']+)'|([^>\/\s]+))/.exec(h[2]),f=s((h[1]||"")+(h[2]||"")+(h[3]||""))),l(e,a&&/^https?:\/\/\S+$/.test(a)?a:f||t||m+"//").then((function(e){if(e){a&&n.record(),v[2].href=e;var t={};/[.\/?&#]/.test(e[0])||/^(data|javascript|mailto):/.test(e)||-1===e.indexOf("://")||(t.rel="nofollow",t.target="_blank");var r=y(v[3]||!1);!1!==r||a||(r=[" "," "]),g&&q.call(n,v[0]),q.call(n,v[0],v[1],p(t,v[2]),r)}else n.focus()})).catch((function(e){return 0}))}return n.record(),!1},x.quote=function(){var e=this;return e.record(),function(e){var t=/<(blockquote|q)(?:\s[^>]*)?>\s*$/,r=/^\s*<\/(blockquote|q)>/,n=e.$(),o=n.after;n.end;var i=n.before;n.start;var a=n.value,c=e.state,s=c.source.tab||c.tab||"\t",u=e.state.defaults||{};a||o&&"\n"!==o[0]||i&&"\n"!==i.slice(-1)?e.match([t,/[\s\S]*/,r],(function(e,n,o){var i,a=this;a.replace(t,"",-1),a.replace(r,"",1),!n[0]||!/\n/.test(n[0])&&(o[0]&&"\n"!==o[0][0]||e[0]&&"\n"!==e[0].slice(-1))?o[0]?u.blockquote[0]===o[1]?(!1!==(i=y(u[""][3]))&&a.trim(i[0],i[1]),a.replace(d("(^|\\n)"+s),"$1")):u.q[0]===o[1]&&(!1!==(i=y(u.blockquote[3]))&&a.trim(i[0],i[1]),a.wrap("<"+u.blockquote[0]+v(u.blockquote[2])+">\n","\n</"+u.blockquote[0]+">").insert(n[0]||u.blockquote[1]),n[0]!==u.blockquote[1]&&n[0]!==u.q[1]&&a.replace(d("(^|\\n)"),"$1"+s)):(!1!==(i=y(u.q[3]))&&a.trim(i[0],i[1]),a.wrap("<"+u.q[0]+v(u.q[2])+">","</"+u.q[0]+">").insert(n[0]||u.q[1]),a.replace(d("(^|\\n)"+s),"$1")):(!1!==(i=y(u.blockquote[3]))&&a.trim(i[0],i[1]),u.blockquote[0]===o[1]?a.replace(d("(^|\\n)"+s),"$1"):(a.wrap("<"+u.blockquote[0]+v(u.blockquote[2])+">\n","\n</"+u.blockquote[0]+">"),a.replace(d("(^|\\n)"),"$1"+s)))})):e.wrap("<"+u.blockquote[0]+v(u.blockquote[2])+">","</"+u.blockquote[0]+">").insert(u.blockquote[1])}(e),e.record(),!1},x.underline=function(){var e=this,t=e.state.defaults||{};return e.record(),q.apply(e,t.u),!1};var S={defaults:{"":["","text goes here…",{},""],a:["a","link text goes here…",{}],area:["area",!1,{}],b:["strong","text goes here…",{}],base:["base",!1,{href:""},"\n"],blockquote:["blockquote","quote goes here…",{},"\n"],br:["br",!1,{},["","\n"]],button:["button","text goes here…",{name:"",type:"submit"}," "],caption:["caption","table caption goes here…",{},"\n"],code:["code","code goes here…",{}," "],col:["col",!1,{},"\n"],em:["em","text goes here…",{}],figcaption:["figcaption","image caption goes here…",{},"\n"],figure:["figure","",{},"\n"],h1:["h1","title goes here…",{},"\n"],h2:["h2","title goes here…",{},"\n"],h3:["h3","title goes here…",{},"\n"],h4:["h4","title goes here…",{},"\n"],h5:["h5","title goes here…",{},"\n"],h6:["h6","title goes here…",{},"\n"],hr:["hr",!1,{},"\n"],i:["em","text goes here…",{}],img:["img",!1,{alt:"",src:""}," "],input:["input",!1,{name:"",type:"text"}," "],li:["li","list item goes here…",{},"\n"],link:["link",!1,{href:""},"\n"],meta:["meta",!1,{},"\n"],ol:["ol","",{},"\n"],option:["option","option goes here…",{},"\n"],p:["p","paragraph goes here…",{},"\n"],param:["param",!1,{name:""},"\n"],pre:["pre","text goes here…",{},"\n"],q:["q","quote goes here…",{}," "],script:["script","code goes here…",{},"\n"],select:["select","",{name:""}," "],source:["source",!1,{src:""},"\n"],strong:["strong","text goes here…",{}],style:["style","code goes here…",{},"\n"],td:["td","data goes here…",{},"\n"],textarea:["textarea","value goes here…",{name:""}," "],th:["th","title goes here…",{},"\n"],tr:["tr","",{},"\n"],track:["track",!1,{},"\n"],u:["u","text goes here…",{}],ul:["ul","",{},"\n"],wbr:["wbr",!1,{},["","\n"]]},source:{type:"HTML"}};e.canKeyDown=function(e,t){var r=t.state,n=r.source.tab||r.tab||"\t",o=r.defaults||{},i=e.key,a=e.queue;if(a.Control){var s=t.$(),u=s.after,l=s.before,p=s.end,f=s.start;s.value;var h=u.split("\n").shift(),g=l.split("\n").pop(),b=g.match(/^(\s+)/),m=b&&b[1]||"";if("Enter"===i){var y=h.match(d(w(k)+"\\s*$","")),x=o[y&&y[1]||"p"]||o.p;return x[3]=["\n"+m,"\n"+(!a.Shift&&u&&d("^\\s*"+w(k)).test(u.split("\n")[1]||"")?m.replace(d("^"+n),""):m)],t.select(a.Shift?f-c(g):p+c(h)),q.apply(t,x),t.record(),!1}}if(a.Alt||a.Control)return!0;if(">"===i){var S,E=t.$(),T=E.after,j=E.before,O=E.end,A=(j.split("\n").pop()+">").match(d($(k)+"$","")),L=o[S=A&&A[1]||""];return!S||(L?!1!==L[1]?(">"===T[0]?t.select(O+1):t.insert(">",-1),t.insert("</"+S+">",1).insert(L[1])):">"===T[0]?t.insert(" /",-1).select(O+3):t.insert(" />",-1):(">"===T[0]?t.select(O+1):t.insert(">",-1),t.insert("</"+S+">",1)),t.record(),!1)}if("Enter"===i){var R,M,_=t.$(),C=_.after,H=_.before,U=_.value,D=C.split("\n").shift(),K=H.split("\n").pop(),P=K.match(/^(\s+)/),W=P&&P[1]||"",z=["li","option","p","td","th"],B=["pre","script","style"];if(R=K.match(d($(k)+"$",""))){var F=o[R[1]];if(F&&!1===F[1])return t.insert("\n"+W,-1).record(),!1}if(a.Shift){var G=o.br;return t.insert("<"+G[0]+v(G[2])+">"+(!1===G[1]?"":G[1]+"</"+G[0]+">")+"\n",-1).record(),!1}if(C&&H){for(var I=0,J=c(z);I<J;++I)if(d("^"+w(M=z[I]),"").test(D)&&(R=K.match(d("^\\s*"+$(M),""))))return R[0]===K?(o[M]&&U&&o[M][1]===U?t.insert("").wrap("\n"+W+n,"\n"+W):q.call(t,M),t.record(),!1):(t.insert("</"+M+">\n"+W+"<"+M+(R[2]||"")+">",-1).insert(o[M]&&o[M][1]||"").record(),!1);for(var N=0,Q=c(B);N<Q;++N)if(d("^"+w(M=B[N]),"").test(D)&&d($(M)+"$","").test(K))return t.wrap("\n"+W,"\n"+W).insert(o[M]&&o[M][1]||"").record(),!1;for(var V=1;V<7;++V)if(D.startsWith("</"+o["h"+V][0]+">")&&K.match(d("^\\s*"+$(o["h"+V][0]),"")))return o["h"+V]&&U&&o["h"+V][1]===U?t.insert("").wrap("\n"+W+n,"\n"+W):t.insert("</"+o["h"+V][0]+">\n"+W+"<"+o.p[0]+">",-1).replace(d("^"+w(o["h"+V][0])),"</"+o.p[0]+">",1).insert(o.p[1]),t.record(),!1}}return!0},e.commands=x,e.state=S,Object.defineProperty(e,"__esModule",{value:!0})}));