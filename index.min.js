/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2021 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).TE=e.TE||{},e.TE.SourceHTML={}))}(this,(function(e){"use strict";var t=function(e){return Array.isArray(e)},r=function(e){return"function"==typeof e},n=function(e,t){return e&&i(t)&&e instanceof t},i=function(e){return function(e){return void 0!==e}(e)&&!function(e){return null===e}(e)},o=function(e){return"string"==typeof e},s=function(e){return e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;")},c=function e(r){if(t(r))return r.map((function(t){return e(r)}));if(function(e,t){return void 0===t&&(t=!0),"object"==typeof e&&(!t||n(e,Object))}(r)){for(var i in r)r[i]=e(r[i]);return r}return!1===r?"false":null===r?"null":!0===r?"true":""+r},p=function(e){return e.length},a=window,l=function(e,t){return function(e){return n(e,RegExp)}(e)?e:(e=e.replace(/\//g,"\\/"),RegExp(e,i(t)?t:"g"))},u={};u.toggle=function(e,t,r,n){void 0===t&&(t=""),void 0===r&&(r={}),void 0===n&&(n=!1);var i=this,p=i.$(),a=p.after,u=p.before,f=p.value,h=function(e){return"<("+e+")(\\s(?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^/>'\"])*)?>"}(e),g=function(e){return"</("+e+")>"}(e),m=l(h+"$",""),d=l("^"+g,""),b=m.test(u),y=d.test(a);return y&&b?i.replace(d,"",1).replace(m,"",-1):(m=l("^"+h,""),d=l(g+"$",""),b=m.test(f),(y=d.test(f))&&b&&i.insert(f=f.replace(d,"").replace(m,"")),!f&&t&&i.insert(t),!1!==n&&(!0===n&&(n=["",""]),o(n)&&(n=[n,n]),i.trim(n[0],n[1]||n[0])),i.wrap("<"+e+function(e){var t,r="";for(t in e)r+=" "+t+'="'+s(c(e[t]))+'"';return r}(r)+">","</"+e+">"))};const{toggle:f}=u;let h="[\\w:.-]+",g=e=>"<("+e+")(\\s(?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^/>'\"])*)?>",m=e=>"</("+e+")>";function d(e){if(!e)return"";let t,r="";for(t in e)r+=" "+t+'="'+s(c(e[t]))+'"';return r}function b(e){return!1!==e&&(o(e)?e=[e,e]:t(e)||(e=["",""]),i(e[1])||(e[1]=e[0])),e}function y(e){let{before:t}=e.$(),r="HTML";l(g("script"),"").test(t)&&!l(m("script"),"").test(t)?r="JS":l(g("style"),"").test(t)&&!l(m("style"),"").test(t)&&(r="CSS"),e.state.source.type=r}const $={source:{type:"HTML"},sourceHTML:{elements:{a:["a","link text goes here…",{}],area:["area",!1,{}],b:["strong","text goes here…",{}],base:["base",!1,{href:""},"\n"],blockquote:["blockquote","",{},"\n"],br:["br",!1,{},["","\n"]],button:["button","text goes here…",{name:"",type:"submit"}," "],caption:["caption","caption goes here…",{},"\n"],code:["code","code goes here…",{}," "],col:["col",!1,{},"\n"],em:["em","text goes here…",{}],figcaption:["figcaption","caption goes here…",{},"\n"],figure:["figure","",{},"\n"],h1:["h1","title goes here…",{},"\n"],h2:["h2","title goes here…",{},"\n"],h3:["h3","title goes here…",{},"\n"],h4:["h4","title goes here…",{},"\n"],h5:["h5","title goes here…",{},"\n"],h6:["h6","title goes here…",{},"\n"],hr:["hr",!1,{},"\n"],i:["em","text goes here…",{}],img:["img",!1,{alt:"",src:""}," "],input:["input",!1,{name:"",type:"text"}," "],li:["li","list item goes here…",{},"\n"],link:["link",!1,{href:""},"\n"],meta:["meta",!1,{},"\n"],ol:["ol","",{},"\n"],option:["option","option goes here…",{},"\n"],p:["p","paragraph goes here…",{},"\n"],param:["param",!1,{name:""},"\n"],pre:["pre","text goes here…",{},"\n"],script:["script","",{},"\n"],select:["select","",{name:""}," "],source:["source",!1,{src:""},"\n"],strong:["strong","text goes here…",{}],style:["style","",{},"\n"],td:["td","data goes here…",{},"\n"],textarea:["textarea","text goes here…",{name:""}," "],th:["th","title goes here…",{},"\n"],tr:["tr","",{},"\n"],track:["track",!1,{},"\n"],u:["u","text goes here…",{}],ul:["ul","",{},"\n"],wbr:["wbr",!1,{},["","\n"]]}}};e.canKeyDown=function(e,{a:t,c:n,s:i},o){let s=o.state,c=s.sourceHTML.tab||s.tab||"\t",a=s.sourceHTML.elements||{},u=s.source.prompt;if(y(o),n){let{after:t,before:n,end:s,start:y,value:$}=o.$(),x=t.split("\n").shift(),w=n.split("\n").pop(),v=w.match(/^(\s+)/),T=v&&v[1]||"";if("b"===e)return f.apply(o,a.b),!1;if("g"===e){if(r(u)){let e=u("URL:",$&&/^https?:\/\/\S+$/.test($)?$:"http://");if(e){$&&(a.img[2].alt=$,o.record());let r=a.img[3]||!1;!1!==(r=b(r))&&o.trim(r[0],""),a.img[2].src=e,t&&"\n"!==t[0]||n&&"\n"!==n.slice(-1)?o.insert("<"+a.img[0]+d(a.img[2])+">"+(!1!==r?r[1]:""),-1,!0):(r=a.figure[3]||!1,!1!==(r=b(r))&&o.trim(r[0],r[1]),o.insert(""),o.wrap(T+"<"+a.figure[0]+d(a.figure[2])+">\n"+T+c,T+"\n</"+a.figure[0]+">"),o.insert("<"+a.img[0]+d(a.img[2])+">\n"+T+c,-1),o.wrap("<"+a.figcaption[0]+d(a.figcaption[2])+">","</"+a.figcaption[0]+">").insert(a.figcaption[1]))}}return o.record(),!1}if("h"===e)return function(e){let t=/<(?:h([1-6])|p)(\s[^>]*)?>$/,r=/^<\/(?:h[1-6]|p)>/;e.match([t,/.*/,r],(function(n,i,o){let s=this,c=+(n[1]||0),p=n[2]||"",a=e.state.sourceHTML.elements||{},l=n[0]?a[n[0].slice(1,-1).split(/\s/)[0]]:["","",{},["",""]];!p&&l[2]&&(p=d(l[2])),s.replace(t,"",-1),s.replace(r,"",1);let u=l[3];!1!==(u=b(u))&&s.trim(u[0],u[1]),c?(++c,c>6?(s.wrap("<"+a.p[0]+(p||d(a.p[2]))+">","</"+a.p[0]+">"),i[0]&&i[0]!==a.h6[1]||s.insert(a.p[1])):(s.wrap("<"+a["h"+c][0]+(p||d(a["h"+c][2]))+">","</"+a["h"+c][0]+">"),i[0]&&i[0]!==a.p[1]||s.insert(a["h"+c][1]))):(s.wrap("<"+a.h1[0]+(p||d(a.h1[2]))+">","</"+a.h1[0]+">"),i[0]&&i[0]!==a.p[1]||s.insert(a.h1[1]))}))}(o),o.record(),!1;if("i"===e)return f.apply(o,a.i),!1;if("k"===e)return function(e){let t=/<(?:pre|code)(?:\s[^>]*)?>(?:\s*<code(?:\s[^>]*)?>)?$/,r=/^(?:<\/code>\s*)?<\/(?:pre|code)>/;e.match([t,/.*/,r],(function(n,i,o){let s,c=this,p=e.state.sourceHTML.elements,a=d(p.code[2]),l=d(p.pre[2]);c.replace(t,"",-1),c.replace(r,"",1),o[0]?/^(?:<\/code>\s*)?<\/pre>/.test(o[0])?c.trim("","").insert(e.$().value.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")):o[0].slice(0,7)==="</"+p.code[0]+">"&&(s=p.pre[3],!1!==(s=b(s))&&c.trim(s[0],s[1]),c.wrap("<"+p.pre[0]+l+"><"+p.code[0]+a+">","</"+p.code[0]+"></"+p.pre[0]+">")):(s=p.code[3],!1!==(s=b(s))&&c.trim(s[0],s[1]),c.wrap("<"+p.code[0]+a+">","</"+p.code[0]+">").insert((e.$().value||p.code[1]).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")))}))}(o),o.record(),!1;if("l"===e){if(r(u)){let e=u("URL:",$&&/^https?:\/\/\S+$/.test($)?$:"http://");a.a[2].href=e,$&&o.record(),e&&f.apply(o,a.a)}return o.record(),!1}if("u"===e)return f.apply(o,a.u),!1;if("Enter"===e){let e=x.match(l(m(h)+"\\s*$","")),t=e&&e[1]||a.p[0];return i?(o.select(y-p(w)),f.apply(o,a[t]||a.p),o.replace(l("^("+m(h)+")\\s*(.)",""),"$1\n"+T+"$3",1),o.replace(l("(^|\\n)\\s*("+g(h)+")$",""),"$1"+T+"$2",-1),o.record(),!1):(o.select(s+p(x)),f.apply(o,a[t]||a.p),o.replace(l("(.)\\s*("+g(h)+")$",""),"$1\n"+T+"$2",-1),o.record(),!1)}}if(t||n)return!0;if("Enter"===e){let e,t,{after:r,before:n,value:i}=o.$(),s=r.split("\n").shift(),c=n.split("\n").pop(),u=c.match(/^(\s+)/),f=u&&u[1]||"";if(!i&&r&&n){let r=["li","option","p","td","th"];for(let n=0,i=p(r);n<i;++n)if(t=r[n],l("^"+m(t),"").test(s)&&(e=c.match(l("^\\s*"+g(t),""))))return e[0]===c?(o.replace(l(g(t)+"$",""),"",-1),o.replace(l("^"+m(t),""),"",1),o.record(),!1):(o.insert("</"+t+">\n"+f+"<"+t+(e[2]||"")+">",-1).insert(a[t]&&a[t][1]||"").record(),!1);let n=["script","style"];for(let e=0,r=p(n);e<r;++e)if(t=n[e],l("^"+m(t),"").test(s)&&l(g(t)+"$","").test(c))return o.wrap("\n"+f,"\n"+f).insert(a[t]&&a[t][1]||"").record(),!1;for(let e=1;e<7;++e)if("</"+a["h"+e][0]+">"===s&&c.match(l("^\\s*"+g(a["h"+e][0]),"")))return o.insert("</"+a["h"+e][0]+">\n"+f+"<"+a.p[0]+">",-1).replace(l("^"+m(a["h"+e][0])),"</"+a.p[0]+">",1).insert(a.p[1]).record(),!1}}return!0},e.canMouseDown=function(e,{a:t,c:r,s:n},i){return a.setTimeout((()=>y(i)),1),!0},e.state=$}));