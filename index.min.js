/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((e="undefined"!=typeof globalThis?globalThis:e||self).TextEditor=e.TextEditor||{},e.TextEditor.SourceHTML=t())}(this,(function(){"use strict";var e=function(e){return Array.isArray(e)},t=function(e){return"function"==typeof e},r=function(e,t){return e&&l(t)&&e instanceof t},n=function(e){return"number"==typeof e},o=function(e,t){return void 0===t&&(t=!0),"object"==typeof e&&(!t||r(e,Object))},l=function(e){return function(e){return void 0!==e}(e)&&!function(e){return null===e}(e)},i=function(e){return e.length},s=function t(){for(var r=arguments.length,n=Array(r),s=0;s<r;s++)n[s]=arguments[s];for(var a,u=n.shift(),c=0,f=i(n);c<f;++c)for(var p in n[c])if(l(u[p]))if(e(u[p])&&e(n[c][p])){u[p]=[].concat(u[p]);for(var h=0,g=i(n[c][p]);h<g;++h)a=n[c][p][h],-1===u[p].indexOf(a)&&u[p].push(n[c][p][h])}else o(u[p])&&o(n[c][p])?u[p]=t({},u[p],n[c][p]):u[p]=n[c][p];else u[p]=n[c][p];return u},a=window.location,u=function(e,t){return function(e){return r(e,RegExp)}(e)?e:(e=e.replace(/\//g,"\\/"),RegExp(e,l(t)?t:"g"))},c=function(e){return e&&e.preventDefault()},f={"":["","text goes here…"],a:["a","link text goes here…",{href:""}],area:["area",!1],b:["strong","text goes here…"],base:["base",!1,{href:""}],blockquote:["blockquote","quote goes here…"],br:["br",!1],button:["button","text goes here…",{name:"",type:"submit"}],caption:["caption","table caption goes here…"],code:["code","code goes here…"],col:["col",!1],dd:["dd","data goes here…"],dl:["dl",""],dt:["dt","title goes here…"],em:["em","text goes here…"],figcaption:["figcaption","image caption goes here…"],figure:["figure",""],h1:["h1","title goes here…"],h2:["h2","title goes here…"],h3:["h3","title goes here…"],h4:["h4","title goes here…"],h5:["h5","title goes here…"],h6:["h6","title goes here…"],hr:["hr",!1],i:["em","text goes here…"],img:["img",!1,{alt:"",src:""}],input:["input",!1,{name:"",type:"text"}],li:["li","list item goes here…"],link:["link",!1,{href:""}],meta:["meta",!1],ol:["ol",""],option:["option","option goes here…"],p:["p","paragraph goes here…"],param:["param",!1,{name:""}],pre:["pre","text goes here…"],q:["q","quote goes here…"],script:["script","code goes here…"],select:["select","",{name:""}],source:["source",!1,{src:""}],strong:["strong","text goes here…"],style:["style","code goes here…"],tbody:["tbody",""],td:["td","data goes here…"],textarea:["textarea","value goes here…",{name:""}],tfoot:["tfoot",""],th:["th","title goes here…"],thead:["thead",""],tr:["tr",""],track:["track",!1],u:["u","text goes here…"],ul:["ul",""],wbr:["wbr",!1]},p=function(e){return"</("+e+")>"},h=function(e){return"<("+e+")(\\s(?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^/>'\"])*)?>"};function g(e){var t,r=this;r.k(!1).pop();var n=r.k();if(!e.defaultPrevented&&!r.keys[n]){var o=r.$(),l=o.after,s=o.before,a=o.end;o.start,o.value;var f=/^(\s+)/.exec(s.split("\n").pop()),h=f&&f[1]||"";return"Enter"===n?(t=u("^"+p("h[1-6]|p")).exec(l))?(c(e),r.select(a+i(t[0])).insert("\n"+h,-1).toggleElementBlock(["p"])):(t=u("^"+p("dt")).exec(l))?(c(e),r.select(a+i(t[0])).insert("\n"+h,-1).toggleElementBlock(["dd"])):(t=u("^"+p("dd|li")).exec(l))?(c(e),r.select(a+i(t[0])).insert("\n"+h,-1).toggleElementBlock([t[1]])):void 0:void 0}}return{attach:function(){var e,r=this;return r.state=s({elements:f},r.state),r.insertElementBlock=function(e,t,n){l(t)||(t=-1),l(n)||(n=!0);var o=r.$(),s=o.after,a=o.before,u=o.end,c=o.start,f=i(s.split("\n").shift()),p=i(a.split("\n").pop());return 1===t?r.select(u+f).insertElement(e,t).insert("\n",1):-1===t?r.select(c-p).insertElement(e,t).insert("\n",-1):r.select(c-p,u+f).trim("\n","\n").insertElement(e,t,n)},r.insertImage=function(e,n,o){return r.prompt(null!=e?e:"URL:",null!=n?n:a.protocol+"//",(function(e){var n,l,i,a;if(!e)return r;var u=r.$().value,c=null!=(n=r.state.elements.img)?n:[];c[0]=null!=(l=c[0])?l:"img",c[1]=null!=(i=c[1])?i:"",c[2]=s({},c[2]||{}),c[2].alt=u||(null!=(a=c[2].alt)?a:""),c[2].src=e,r.record().insertElement(c).record(),t(o)&&o.call(r,e)}))},r.insertLink=function(e,n,o){return r.prompt(null!=e?e:"URL:",null!=n?n:a.protocol+"//",(function(e){var n,l,i;if(!e)return r;var a=null!=(n=r.state.elements.a)?n:[];a[0]=null!=(l=a[0])?l:"a",a[1]=null!=(i=a[1])?i:"",a[2]=s({},a[2]||{}),a[2].href=e,r.record().wrapElement(a).record(),t(o)&&o.call(r,e)}))},r.peelElementBlock=function(e,t,n){return r.peelElement(e,t,n).trim("","",!1,!1)},r.toggleElementBlock=function(t,n,o){var l=r.$(),i=l.after,s=l.before,a=l.value;return"string"==typeof t&&(e=u("^"+h("[\\w:.-]+")+"$","").exec(t))&&(t=[e[1]]),o?r[(u("^"+h(t[0])+"[\\s\\S]*?"+p(t[0])+"$","").test(a)?"peel":"wrap")+"ElementBlock"](t,n,o):r[(u("^"+p(t[0]),"").test(i)&&u(h(t[0])+"$","").test(s)?"peel":"wrap")+"ElementBlock"](t,n,o)},r.wrapElementBlock=function(e,t,o){var l,i=r.$(),s=i.after,a=i.before;i.value;var c,f=(null==(l=r.state.source)?void 0:l.tab)||r.state.tab||"\t",p=/^(\s+)/.exec(a.split("\n").pop()),g=p&&p[1]||"",d=u(h("[\\w:.-]+")+"$","").exec(a.trim());return n(c=f)&&0==c%1&&(f=" ".repeat(f)),d&&s.trim().startsWith("</"+d[1]+">")&&(r.trim("","",!1,!1),g=(p=/^(\s+)/.exec(r.$().before.split("\n").pop()))&&p[1]||"",r.wrap("\n"+g+f,"\n"+g)),r.wrapElement(e,t,o)},r.on("key.down",g)},detach:function(){return this.off("key.down",g)}}}));