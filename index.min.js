/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2021 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).TE=e.TE||{},e.TE.SourceHTML={}))}(this,(function(e){"use strict";var t=function(e,t){return-1!==t.indexOf(e)},r=function(e){return Array.isArray(e)},n=function(e){return"function"==typeof e},o=function(e,t){return e&&s(t)&&e instanceof t},i=function(e,t){return void 0===t&&(t=!0),"object"==typeof e&&(!t||o(e,Object))},s=function(e){return function(e){return void 0!==e}(e)&&!function(e){return null===e}(e)},c=function(e){return"string"==typeof e},a=function(e){return e.length},l=function(e){return e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;")},u=function e(){for(var n=arguments.length,o=Array(n),c=0;c<n;c++)o[c]=arguments[c];for(var l=o.shift(),u=0,p=a(o);u<p;++u)for(var f in o[u])if(s(l[f]))if(r(l[f])&&r(o[u][f])){l[f]=[].concat(l[f]);for(var h=0,g=a(o[u][f]);h<g;++h)t(o[u][f][h],l[f])||l[f].push(o[u][f][h])}else i(l[f])&&i(o[u][f])?l[f]=e({},l[f],o[u][f]):l[f]=o[u][f];else l[f]=o[u][f];return l},p=function e(t){if(r(t))return t.map((function(r){return e(t)}));if(i(t)){for(var n in t)t[n]=e(t[n]);return t}return!1===t?"false":null===t?"null":!0===t?"true":""+t},f=window.location,h=function(e,t){return function(e){return o(e,RegExp)}(e)?e:(e=e.replace(/\//g,"\\/"),RegExp(e,s(t)?t:"g"))},g={};function d(e){if(!e)return"";var t;e=(t=e,Object.keys(t)).sort().reduce((function(t,r){return t[r]=e[r],t}),{});var r,n,o="";for(r in e)!1!==(n=e[r])&&null!==n&&(o+=" "+r,!0!==n&&(o+='="'+l(p(n))+'"'));return o}function m(e){return!1!==e&&(c(e)?e=[e,e]:r(e)||(e=["",""]),s(e[1])||(e[1]=e[0])),e}g.insert=function(e,t,r,n){void 0===t&&(t=""),void 0===r&&(r={}),void 0===n&&(n=!1);return!1!==(n=m(n))&&this.trim(n[0],""),this.insert("<"+e+d(r)+(!1!==t?">"+t+"</"+e+">":" />")+(!1!==n?n[1]:""),-1,!0)},g.toggle=function(e,t,r,n){void 0===t&&(t=""),void 0===r&&(r={}),void 0===n&&(n=!1);var o=this,i=o.$(),s=i.after,c=i.before,a=i.value,l=function(e){return"<("+e+")(\\s(?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^/>'\"])*)?>"}(e),u=function(e){return"</("+e+")>"}(e),p=h(l+"$",""),f=h("^"+u,""),g=p.test(c),b=f.test(s);return b&&g?o.replace(f,"",1).replace(p,"",-1):(p=h("^"+l,""),f=h(u+"$",""),g=p.test(a),(b=f.test(a))&&g&&o.insert(a=a.replace(f,"").replace(p,"")),!a&&t&&o.insert(t),!1!==(n=m(n))&&o.trim(n[0],n[1]),o.wrap("<"+e+d(r)+">","</"+e+">"))},g.wrap=function(e,t,r,n){void 0===t&&(t=""),void 0===r&&(r={}),void 0===n&&(n=!1);var o=this,i=o.$();return i.after,i.before,!i.value&&t&&o.insert(t),!1!==(n=m(n))&&o.trim(n[0],n[1]),o.wrap("<"+e+d(r)+">","</"+e+">")};const b=f.protocol,{toggle:v}=g;let q="[\\w:.-]+",y=e=>"<("+e+")(\\s(?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^/>'\"])*)?>",w=e=>"</("+e+")>";function k(e){return!1!==e&&(c(e)?e=[e,e]:r(e)||(e=["",""]),s(e[1])||(e[1]=e[0])),e}const x={};x.blocks=function(){return function(e){let t=/<(?:h([1-6])|p)(\s[^>]*)?>$/,r=/^<\/(?:h[1-6]|p)>/;e.match([t,/.*/,r],(function(n,o,i){let s=this,c=+(n[1]||0),a=n[2]||"",l=e.state.sourceHTML.elements||{},u=n[0]?l[n[0].slice(1,-1).split(/\s/)[0]]:["","",{}];!a&&u[2]&&(a=d(u[2])),s.replace(t,"",-1),s.replace(/\n+/g," "),s.replace(r,"",1);let p=u[3]||l.h1[3];!1!==(p=k(p))&&s.trim(p[0],p[1]),c?(++c,c>6?(s.wrap("<"+l.p[0]+(a||d(l.p[2]))+">","</"+l.p[0]+">"),o[0]&&o[0]!==l.h6[1]||s.insert(l.p[1])):(s.wrap("<"+l["h"+c][0]+(a||d(l["h"+c][2]))+">","</"+l["h"+c][0]+">"),o[0]&&o[0]!==l.p[1]||s.insert(l["h"+c][1]))):(s.wrap("<"+l.h1[0]+(a||d(l.h1[2]))+">","</"+l.h1[0]+">"),o[0]&&o[0]!==l.p[1]||s.insert(l.h1[1]))}))}(this),this.record(),!1},x.bold=function(){let e=this.state.sourceHTML.elements||{};return v.apply(this,e.b),!1},x.code=function(){return function(e){let t=/<(?:pre|code)(?:\s[^>]*)?>(?:\s*<code(?:\s[^>]*)?>)?$/,r=/^(?:<\/code>\s*)?<\/(?:pre|code)>/;e.match([t,/.*/,r],(function(n,o,i){let s,c=this,a=e.state.sourceHTML.elements;c.replace(t,"",-1),c.replace(r,"",1),i[0]?/^(?:<\/code>\s*)?<\/pre>/.test(i[0])?(s=a[""][3],!1!==(s=k(s))&&c.trim(s[0],s[1]),c.insert(o[0].replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"))):i[0].slice(0,7)==="</"+a.code[0]+">"&&(s=a.pre[3],!1!==(s=k(s))&&c.trim(s[0],s[1]),c.wrap("<"+a.pre[0]+d(a.pre[2])+"><"+a.code[0]+d(a.code[2])+">","</"+a.code[0]+"></"+a.pre[0]+">")):(s=a.code[3],!1!==(s=k(s))&&c.trim(s[0],s[1]),c.wrap("<"+a.code[0]+d(a.code[2])+">","</"+a.code[0]+">").insert((o[0]||a.code[1]).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")))}))}(this),this.record(),!1},x.image=function(e="URL:",t){let r=this,{after:o,before:i,value:s}=r.$(),c=r.state,a=c.sourceHTML.elements||{},l=c.sourceHTML.tab||c.source.tab||c.tab||"\t",u=i.split("\n").pop().match(/^(\s+)/),p=u&&u[1]||"",f=c.source.prompt;return n(f)&&f(e,s&&/^https?:\/\/\S+$/.test(s)?s:t||b+"//").then((e=>{if(!e)return void r.focus();let t=a.img;s&&(t[2].alt=s,r.record());let n=t[3]||!1;!1!==(n=k(n))&&r.trim(n[0],""),t[2].src=e,o&&"\n"!==o[0]||i&&"\n"!==i.slice(-1)?r.insert("<"+t[0]+d(t[2])+">"+(!1!==n?n[1]:""),-1,!0):(n=a.figure[3]||!1,!1!==(n=k(n))&&r.trim(n[0],n[1]),r.insert(""),r.wrap(p+"<"+a.figure[0]+d(a.figure[2])+">\n"+p+l,p+"\n</"+a.figure[0]+">"),r.insert("<"+t[0]+d(t[2])+">\n"+p+l,-1),r.wrap("<"+a.figcaption[0]+d(a.figcaption[2])+">","</"+a.figcaption[0]+">").insert(a.figcaption[1]))})),r.record(),!1},x.italic=function(){let e=this.state.sourceHTML.elements||{};return v.apply(this,e.i),!1},x.link=function(e="URL:",t){let r=this,{value:o}=r.$(),i=r.state,s=i.sourceHTML.elements||{},c=i.source.prompt;return n(c)&&c(e,o&&/^https?:\/\/\S+$/.test(o)?o:t||b+"//").then((e=>{if(!e)return void r.focus();let t=s.a;o&&r.record(),t[2].href=e;let n={};/[.\/?&#]/.test(e[0])||/^(data|javascript|mailto):/.test(e)||-1===e.indexOf("://")||(n.rel="nofollow",n.target="_blank");let i=k(t[3]||!1);!1!==i||o||(i=[" "," "]),v.call(r,t[0],t[1],u(n,t[2]),i)})),r.record(),!1},x.quote=function(){return function(e){let t=/<(blockquote|q)(?:\s[^>]*)?>\s*$/,r=/^\s*<\/(blockquote|q)>/;e.match([t,/.*/,r],(function(n,o,i){let s,c=this,a=e.state,l=a.sourceHTML.tab||a.source.tab||a.tab||"\t",u=e.state.sourceHTML.elements||{};c.replace(t,"",-1),c.replace(r,"",1),i[0]?u.blockquote[0]===i[1]?!1!==(s=k(u[""][3]))&&c.trim(s[0],s[1]):u.q[0]===i[1]&&(!1!==(s=k(u.blockquote[3]))&&c.trim(s[0],s[1]),c.wrap("<"+u.blockquote[0]+d(u.blockquote[2])+">\n","\n</"+u.blockquote[0]+">").insert(o[0]||u.blockquote[1]),c.replace(h("(^|\\n)"),"$1"+l)):(!1!==(s=k(u.q[3]))&&c.trim(s[0],s[1]),c.wrap("<"+u.q[0]+d(u.q[2])+">","</"+u.q[0]+">").insert(o[0]||u.q[1]),c.replace(h("(^|\\n)"+l),"$1"))}))}(this),this.record(),!1},x.underline=function(){let e=this.state.sourceHTML.elements||{};return v.apply(this,e.u),!1};const T={source:{type:"HTML"},sourceHTML:{elements:{"":["","text goes here…",{},""],a:["a","link text goes here…",{}],area:["area",!1,{}],b:["strong","text goes here…",{}],base:["base",!1,{href:""},"\n"],blockquote:["blockquote","",{},"\n"],br:["br",!1,{},["","\n"]],button:["button","text goes here…",{name:"",type:"submit"}," "],caption:["caption","caption goes here…",{},"\n"],code:["code","code goes here…",{}," "],col:["col",!1,{},"\n"],em:["em","text goes here…",{}],figcaption:["figcaption","caption goes here…",{},"\n"],figure:["figure","",{},"\n"],h1:["h1","title goes here…",{},"\n"],h2:["h2","title goes here…",{},"\n"],h3:["h3","title goes here…",{},"\n"],h4:["h4","title goes here…",{},"\n"],h5:["h5","title goes here…",{},"\n"],h6:["h6","title goes here…",{},"\n"],hr:["hr",!1,{},"\n"],i:["em","text goes here…",{}],img:["img",!1,{alt:"",src:""}," "],input:["input",!1,{name:"",type:"text"}," "],li:["li","list item goes here…",{},"\n"],link:["link",!1,{href:""},"\n"],meta:["meta",!1,{},"\n"],ol:["ol","",{},"\n"],option:["option","option goes here…",{},"\n"],p:["p","paragraph goes here…",{},"\n"],param:["param",!1,{name:""},"\n"],pre:["pre","text goes here…",{},"\n"],q:["q","quote goes here…",{}," "],script:["script","",{},"\n"],select:["select","",{name:""}," "],source:["source",!1,{src:""},"\n"],strong:["strong","text goes here…",{}],style:["style","",{},"\n"],td:["td","data goes here…",{},"\n"],textarea:["textarea","text goes here…",{name:""}," "],th:["th","title goes here…",{},"\n"],tr:["tr","",{},"\n"],track:["track",!1,{},"\n"],u:["u","text goes here…",{}],ul:["ul","",{},"\n"],wbr:["wbr",!1,{},["","\n"]]}}};e.canKeyDown=function(e,t){let r=t.state,n=r.sourceHTML.tab||r.source.tab||r.tab||"\t",o=r.sourceHTML.elements||{},{key:i,queue:s}=e;if(s.Control){let{after:e,before:r,end:n,start:c,value:l}=t.$(),u=e.split("\n").shift(),p=r.split("\n").pop(),f=p.match(/^(\s+)/),g=f&&f[1]||"";if("Enter"===i){let e=u.match(h(w(q)+"\\s*$","")),r=o[e&&e[1]||"p"]||o.p;return r[3]=["\n"+g,"\n"+g],t.select(s.Shift?c-a(p):n+a(u)),v.apply(t,r),t.record(),!1}}if(s.Alt||s.Control)return!0;if(">"===i){let e,{after:r,before:n,end:i}=t.$(),s=(n.split("\n").pop()+">").match(h(y(q)+"$","")),c=o[e=s&&s[1]||""];return!e||(c?!1!==c[1]?(">"===r[0]?t.select(i+1):t.insert(">",-1),t.insert("</"+e+">",1).insert(c[1])):">"===r[0]?t.insert(" /",-1).select(i+3):t.insert(" />",-1):(">"===r[0]?t.select(i+1):t.insert(">",-1),t.insert("</"+e+">",1)),t.record(),!1)}if("Enter"===i){let e,r,{after:i,before:s,value:c}=t.$(),l=i.split("\n").shift(),u=s.split("\n").pop(),p=u.match(/^(\s+)/),f=p&&p[1]||"",g=["li","option","p","td","th"],d=["script","style"];if(e=u.match(h(y(q)+"$",""))){let r=o[e[1]];if(r&&!1===r[1])return t.insert("\n"+f,-1).record(),!1}if(i&&s){for(let i=0,s=a(g);i<s;++i)if(r=g[i],h("^"+w(r),"").test(l)&&(e=u.match(h("^\\s*"+y(r),""))))return e[0]===u?(o[r]&&c&&o[r][1]===c?t.insert("").wrap("\n"+f+n,"\n"+f):v.call(t,r),t.record(),!1):(t.insert("</"+r+">\n"+f+"<"+r+(e[2]||"")+">",-1).insert(o[r]&&o[r][1]||"").record(),!1);for(let e=0,n=a(d);e<n;++e)if(r=d[e],h("^"+w(r),"").test(l)&&h(y(r)+"$","").test(u))return t.wrap("\n"+f,"\n"+f).insert(o[r]&&o[r][1]||"").record(),!1;for(let e=1;e<7;++e)if(l.startsWith("</"+o["h"+e][0]+">")&&u.match(h("^\\s*"+y(o["h"+e][0]),"")))return o["h"+e]&&c&&o["h"+e][1]===c?t.insert("").wrap("\n"+f+n,"\n"+f):t.insert("</"+o["h"+e][0]+">\n"+f+"<"+o.p[0]+">",-1).replace(h("^"+w(o["h"+e][0])),"</"+o.p[0]+">",1).insert(o.p[1]),t.record(),!1}}return!0},e.commands=x,e.state=T}));