/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((e="undefined"!=typeof globalThis?globalThis:e||self).TextEditor=e.TextEditor||{},e.TextEditor.SourceHTML=t())}(this,(function(){"use strict";var e=function(e){return Array.isArray(e)},t=function(e){return"function"==typeof e},r=function(e,t){return e&&i(t)&&e instanceof t},n=function(e){return o(e)&&0==e%1},o=function(e){return"number"==typeof e},l=function(e,t){return void 0===t&&(t=!0),"object"==typeof e&&(!t||r(e,Object))},i=function(e){return function(e){return void 0!==e}(e)&&!function(e){return null===e}(e)},s=function(e){return e.length},c=function t(){for(var r=arguments.length,n=Array(r),o=0;o<r;o++)n[o]=arguments[o];for(var c,a=n.shift(),u=0,f=s(n);u<f;++u)for(var g in n[u])if(i(a[g]))if(e(a[g])&&e(n[u][g])){a[g]=[].concat(a[g]);for(var p=0,h=s(n[u][g]);p<h;++p)c=n[u][g][p],-1===a[g].indexOf(c)&&a[g].push(n[u][g][p])}else l(a[g])&&l(n[u][g])?a[g]=t({},a[g],n[u][g]):a[g]=n[u][g];else a[g]=n[u][g];return a},a=window.location,u=function(e,t){return function(e){return r(e,RegExp)}(e)?e:(e=e.replace(/\//g,"\\/"),RegExp(e,i(t)?t:"g"))},f=function(e){return e&&e.preventDefault()},g="Control-",p="Shift-",h="Enter",d={"":["","text goes here…"],a:["a","link text goes here…",{href:""}],area:["area",!1],b:["strong","text goes here…"],base:["base",!1,{href:""}],blockquote:["blockquote",""],br:["br",!1],button:["button","text goes here…",{name:"",type:"submit"}],caption:["caption","Caption goes here…"],code:["code","code goes here…"],col:["col",!1],dd:["dd","Data goes here…"],dl:["dl",""],dt:["dt","Title goes here…"],em:["em","text goes here…"],figcaption:["figcaption","Caption goes here…"],figure:["figure",""],h1:["h1","Title goes here…"],h2:["h2","Title goes here…"],h3:["h3","Title goes here…"],h4:["h4","Title goes here…"],h5:["h5","Title goes here…"],h6:["h6","Title goes here…"],hr:["hr",!1],i:["em","text goes here…"],img:["img",!1,{alt:"",src:""}],input:["input",!1,{name:"",type:"text"}],li:["li","List item goes here…"],link:["link",!1,{href:""}],meta:["meta",!1],ol:["ol",""],option:["option","Option goes here…"],p:["p","Paragraph goes here…"],param:["param",!1,{name:""}],pre:["pre","text goes here…"],q:["q","quote goes here…"],script:["script","Code goes here…"],select:["select","",{name:""}],source:["source",!1,{src:""}],strong:["strong","text goes here…"],style:["style","Code goes here…"],tbody:["tbody",""],td:["td","Data goes here…"],textarea:["textarea","value goes here…",{name:""}],tfoot:["tfoot",""],th:["th","Title goes here…"],thead:["thead",""],tr:["tr",""],track:["track",!1],u:["u","text goes here…"],ul:["ul",""],wbr:["wbr",!1]},k=function(e){return"</("+e+")>"},E=function(e){return"<("+e+")(\\s(?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^/>'\"])*)?>"};function v(e){var t,r,o=this;o.k(!1).pop();var l=o.k();if(!e.defaultPrevented&&!o.keys[l]){var i=o.$(),c=i.after,a=i.before,m=i.end;i.start;var d=i.value,v=(null==(t=o.state.source)?void 0:t.tab)||o.state.tab||"\t",b=o.state.elements||{},x=/^\s+/.exec(a.split("\n").pop()),y=x&&x[0]||"";return n(v)&&(v=" ".repeat(v)),g+p+h===l?(f(e),(a?o.insertBlock("",-1):o).toggleElementBlock(["p"])):g+h===l?(f(e),(a?o.insertBlock("",1):o).toggleElementBlock(["p"])):p+h===l?(f(e),o.insertElement(["br",!1]).insert("\n",-1,!0).record()):h===l?(r=u("^"+k("h[1-6]|p")).exec(c))?(f(e),!d&&u(E(r[1])+"$","").test(a)||d&&b[r[1]]&&d===b[r[1]][1]?o.trim("\n"+y+v,"\n"+y).insert("").record():o.select(m+s(r[0])).insert("\n"+y,-1).toggleElementBlock(["p"]).record()):(r=u("^"+k("dt")).exec(c))?(f(e),!d&&u(E(r[1])+"$","").test(a)||d&&b[r[1]]&&d===b[r[1]][1]?o.trim("\n"+y+v,"\n"+y).insert("").record():o.select(m+s(r[0])).insert("\n"+y,-1).toggleElementBlock(["dd"]).record()):(r=u("^"+k("dd|li|t[dh]")).exec(c))?(f(e),!d&&u(E(r[1])+"$","").test(a)||d&&b[r[1]]&&d===b[r[1]][1]?o.trim("\n"+y+v,"\n"+y).insert("").record():o.select(m+s(r[0])).insert("\n"+y,-1).toggleElementBlock([r[1]]).record()):void 0:void 0}}return{attach:function(){var e=this,r=e.constructor.prototype;return e.state=c({elements:d,elementsCurrent:{}},e.state),!t(r.insertElementBlock)&&(r.insertElementBlock=function(e,t,r){var n=this;i(t)||(t=-1),i(r)||(r=!0);var o=n.$(),l=o.after,c=o.before,a=o.end,u=o.start,f=s(l.split("\n").shift()),g=s(c.split("\n").pop());return 1===t?n.select(a+f).insertElement(e,t).insert("\n",1):-1===t?n.select(u-g).insertElement(e,t).insert("\n",-1):n.select(u-g,a+f).trim("\n","\n").insertElement(e,t,r)}),!t(r.insertImage)&&(r.insertImage=function(e,r,n){var o=this;return o.prompt(null!=e?e:"URL:",null!=r?r:a.protocol+"//",(function(e){var r,l,i,s;if(!e)return o;var a=o.$().value,u=null!=(r=o.state.elements.img)?r:[];u[0]=null!=(l=u[0])?l:"img",u[1]=null!=(i=u[1])?i:"",u[2]=c({},u[2]||{}),u[2].alt=a||(null!=(s=u[2].alt)?s:""),u[2].src=e,o.record().insertElement(u).record(),t(n)&&n.call(o,e)}))}),!t(r.insertLink)&&(r.insertLink=function(e,r,n){var o=this;return o.prompt(null!=e?e:"URL:",null!=r?r:a.protocol+"//",(function(e){var r,l,i;if(!e)return o;var s=null!=(r=o.state.elements.a)?r:[];s[0]=null!=(l=s[0])?l:"a",s[1]=null!=(i=s[1])?i:"",s[2]=c({},s[2]||{}),s[2].href=e,o.record().wrapElement(s).record(),t(n)&&n.call(o,e)}))}),!t(r.peelElementBlock)&&(e.peelElementBlock=function(e,t,r){}),!t(r.toggleCode)&&(r.toggleCode=function(){}),!t(r.toggleElementBlock)&&(r.toggleElementBlock=function(e,t,r){var n=this,o=n.$(),l=o.after,i=o.before,s=o.value;return"string"==typeof e&&(m=u("^"+E("[\\w:.-]+")+"$","").exec(e))&&(e=[m[1]]),r?n[(u("^"+E(e[0])+"[\\s\\S]*?"+k(e[0])+"$","").test(s)?"peel":"wrap")+"ElementBlock"](e,t,r):n[(u("^"+k(e[0]),"").test(l)&&u(E(e[0])+"$","").test(i)?"peel":"wrap")+"ElementBlock"](e,t,r)}),!t(r.toggleElements)&&(r.toggleElements=function(e,t){}),!t(r.toggleElementsBlock)&&(r.toggleElementsBlock=function(e,t){var r=this,n=s(e),o=r.state.elementsCurrent.block||0;return e.forEach((function(e){return e?r.selectBlock().peelElement(e,!0):r})),e[o]&&r.wrapElementBlock(e[o],t),o>=n-1?o=0:o+=1,r.state.elementsCurrent.block=o,r}),!t(r.toggleQuote)&&(r.toggleQuote=function(){}),!t(r.wrapElementBlock)&&(r.wrapElementBlock=function(e,t,r){var o,l=this,i=l.$(),s=i.after,c=i.before;i.value;var a=(null==(o=l.state.source)?void 0:o.tab)||l.state.tab||"\t",f=/^\s+/.exec(c.split("\n").pop()),g=f&&f[0]||"",p=u(E("[\\w:.-]+")+"$","").exec(c.trim());return n(a)&&(a=" ".repeat(a)),p&&s.trim().startsWith("</"+p[1]+">")&&(l.trim("","",!1,!1),g=(f=/^\s+/.exec(l.$().before.split("\n").pop()))&&f[0]||"",l.wrap("\n"+g+a,"\n"+g)),l.wrapElement(e,t,r)}),e.on("key.down",v)},detach:function(){return this.off("key.down",v)},name:"TextEditor.SourceHTML"}}));