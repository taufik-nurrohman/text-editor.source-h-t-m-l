/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2021 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).TE=e.TE||{},e.TE.SourceHTML={}))}(this,(function(e){"use strict";var t=function(e){return"function"==typeof e},r=function(e,t){return e&&n(t)&&e instanceof t},n=function(e){return function(e){return void 0!==e}(e)&&!function(e){return null===e}(e)},o=function(e){return"string"==typeof e},i=function e(t){if(function(e){return Array.isArray(e)}(t))return t.map((function(r){return e(t)}));if(function(e,t){return void 0===t&&(t=!0),"object"==typeof e&&(!t||r(e,Object))}(t)){for(var n in t)t[n]=e(t[n]);return t}return!1===t?"false":null===t?"null":!0===t?"true":""+t},c=function(e){return e.length},l=window,p=function(e,t){return function(e){return r(e,RegExp)}(e)?e:(e=e.replace(/\//g,"\\/"),RegExp(e,n(t)?t:"g"))},a={};a.toggle=function(e,t,r,n){void 0===t&&(t=""),void 0===r&&(r={}),void 0===n&&(n=!1);var c=this,l=c.$(),a=l.after,s=l.before,u=l.value,f=function(e){return"<("+e+")(\\s(?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^/>'\"])*)?>"}(e),h=function(e){return"</("+e+")>"}(e),g=p(f+"$",""),d=p("^"+h,""),m=g.test(s),b=d.test(a);return b&&m?c.replace(d,"",1).replace(g,"",-1):(g=p("^"+f,""),d=p(h+"$",""),m=g.test(u),(b=d.test(u))&&m&&c.insert(u=u.replace(d,"").replace(g,"")),!u&&t&&c.insert(t),!1!==n&&(!0===n&&(n=["",""]),o(n)&&(n=[n,n]),c.trim(n[0],n[1]||n[0])),c.wrap("<"+e+function(e){var t,r="";for(t in e)r+=" "+t+'="'+i(e[t]).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;")+'"';return r}(r)+">","</"+e+">"))};const s={sourceHTML:{input:(e,t)=>l.prompt(e,t),object:{a:["a","link text goes here…",{},""],area:["area",!1,{},""],b:["strong","text goes here…",{},""],base:["base",!1,{},"\n"],blockquote:["blockquote","",{},"\n"],br:["br",!1,{},["","\n"]],code:["code","code goes here…",{},""],col:["col",!1,{},"\n"],em:["em","text goes here…",{},""],h1:["h1","title goes here…",{},"\n"],h2:["h2","title goes here…",{},"\n"],h3:["h3","title goes here…",{},"\n"],h4:["h4","title goes here…",{},"\n"],h5:["h5","title goes here…",{},"\n"],h6:["h6","title goes here…",{},"\n"],hr:["hr",!1,{},"\n"],i:["em","text goes here…",{},""],img:["img",!1,{alt:""}," "],input:["input",!1,{}," "],li:["li","",{},"\n"],link:["link",!1,{},"\n"],meta:["meta",!1,{},"\n"],ol:["ol","",{},"\n"],option:["option","option goes here…",{},"\n"],p:["p","paragraph goes here…",{},"\n"],param:["param",!1,{},"\n"],pre:["pre","text goes here…",{},"\n"],source:["source",!1,{},"\n"],strong:["strong","text goes here…",{},""],td:["td","",{},"\n"],th:["th","",{},"\n"],tr:["tr","",{},"\n"],track:["track",!1,{},"\n"],u:["u","text goes here…",{},""],ul:["ul","",{},"\n"],wbr:["wbr",!1,{},["","\n"]]}}},{toggle:u}=a;let f="[\\w:.-]+",h=e=>"<("+e+")(\\s(?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^/>'\"])*)?>",g=e=>"</("+e+")>";const d=s;e.canKeyDown=function(e,{a:r,c:n,s:i},l){let a=l.state,s=a.sourceHTML?.object||{};a.sourceHTML?.tab||a.tab;let d=a.sourceHTML?.input;if(n){if("b"===e)return u.apply(l,s.b),!1;if("g"===e){if(t(d)){let e=l.$().value,t=d("URL:",e&&/^https?:\/\/\S+$/.test(e)?e:"http://");if(s.img[2].src=t,e&&(s.img[2].alt=e,l.record()),t){let r=s.img[3]||!1;!1!==r&&(!0===r&&(r=["",""]),o(r)&&(r=[r,r])),l.trim(r[0],""),l.insert("<"+s.img[0]+' alt="'+e+'" src="'+t+'">'+(r[1]||r[0]),-1,!0)}}return l.record(),!1}if("h"===e)return function(e){let t=/<(?:h([1-6])|p)(\s[^>]*)?>$/,r=/^<\/(?:h[1-6]|p)>/;e.match([t,/.*/,r],(function(e,n,o){let i=this,c=+(e[1]||0),l=e[2]||"";i.replace(t,"",-1),i.replace(r,"",1),i.trim("\n","\n"),c?(++c,c>6?i.wrap("<p"+l+">","</p>"):i.wrap("<h"+c+l+">","</h"+c+">")):i.wrap("<h1"+l+">","</h1>")}))}(l),l.record(),!1;if("i"===e)return u.apply(l,s.i),!1;if("k"===e)return function(e){let t=/<(?:pre|code)(?:\s[^>]*)?>(?:\s*<code(?:\s[^>]*)?>)?$/,r=/^(?:<\/code>\s*)?<\/(?:pre|code)>/;e.match([t,/.*/,r],(function(n,o,i){let c=this;c.replace(t,"",-1),c.replace(r,"",1),i[0]?/^(?:<\/code>\s*)?<\/pre>/.test(i[0])?c.trim(" "," ").insert(e.$().value.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")):"</code>"===i[0].slice(0,7)&&c.trim("\n","\n").wrap("<pre><code>","</code></pre>"):c.trim(" "," ").wrap("<code>","</code>").insert(e.$().value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"))}))}(l),l.record(),!1;if("l"===e){if(t(d)){let e=l.$().value,t=d("URL:",e&&/^https?:\/\/\S+$/.test(e)?e:"http://");s.a[2].href=t,e&&l.record(),t&&u.apply(l,s.a)}return l.record(),!1}if("u"===e)return u.apply(l,s.u),!1;if("Enter"===e){let e,{after:t,before:r,end:n,start:o,value:a}=l.$(),d=t.split("\n").shift(),m=r.split("\n").pop(),b=m.match(/^(\s+)/),$=b&&b[1]||"";if(""===a){e=d.match(p(g(f)+"\\s*$",""));let t=e&&e[1]||s.p[0];return i?(l.select(o-c(m)),u.apply(l,s[t]||s.p),l.replace(p("^("+g(f)+")\\s*(.)",""),"$1\n"+$+"$3",1),l.replace(p("(^|\\n)\\s*("+h(f)+")$",""),"$1"+$+"$2",-1),l.record(),!1):(l.select(n+c(d)),u.apply(l,s[t]||s.p),l.replace(p("(.)\\s*("+h(f)+")$",""),"$1\n"+$+"$2",-1),l.record(),!1)}return!0}}if(r||n)return!0;if("Enter"===e){let e,{after:t,before:r,value:n}=l.$(),o=t.split("\n").shift(),i=r.split("\n").pop(),a=i.match(/^(\s+)/),u=a&&a[1]||"";if(!n&&t&&r){let t,r=["li","option","p","td","th"];for(let n=0,a=c(r);n<a;++n)if((t=s[r[n]])&&(t=t[0],"</"+t+">"===o&&(e=i.match(p("^\\s*"+h(t),"")))))return e[0]===i?(l.replace(p(h(t)+"$",""),"",-1),l.replace(p("^"+g(t),""),"",1),l.record(),!1):(l.insert("</"+t+">\n"+u+"<"+t+(e[2]||"")+">",-1).record(),!1);for(let e=1;e<7;++e)if("</"+s["h"+e][0]+">"===o&&i.match(p("^\\s*"+h(s["h"+e][0]),"")))return l.insert("</"+s["h"+e][0]+">\n"+u+"<"+s.p[0]+">",-1).replace(p("^"+g(s["h"+e][0])),"</"+s.p[0]+">",1).record(),!1}}return!0},e.state=d}));