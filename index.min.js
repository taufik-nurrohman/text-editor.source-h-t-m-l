/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2021 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).TE=e.TE||{},e.TE.SourceHTML={}))}(this,(function(e){"use strict";var t=function(e,t){return e&&r(t)&&e instanceof t},r=function(e){return function(e){return void 0!==e}(e)&&!function(e){return null===e}(e)},n=function e(r){if(function(e){return Array.isArray(e)}(r))return r.map((function(t){return e(r)}));if(function(e,r){return void 0===r&&(r=!0),"object"==typeof e&&(!r||t(e,Object))}(r)){for(var n in r)r[n]=e(r[n]);return r}return!1===r?"false":null===r?"null":!0===r?"true":""+r},o=function(e){return e.length},i=window,c=function(e,n){return function(e){return t(e,RegExp)}(e)?e:(e=e.replace(/\//g,"\\/"),RegExp(e,r(n)?n:"g"))},l={};l.toggle=function(e,t,r){void 0===t&&(t=""),void 0===r&&(r={});var o=this,i=o.$(),l=i.after,p=i.before,a=i.value,s=function(e){return"<("+e+")(\\s(?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^/>'\"])*)?>"}(e),u=function(e){return"</("+e+")>"}(e),f=c(s+"$",""),h=c("^"+u,""),g=f.test(p),d=h.test(l);return d&&g?o.replace(h,"",1).replace(f,"",-1):(f=c("^"+s,""),h=c(u+"$",""),g=f.test(a),(d=h.test(a))&&g&&o.insert(a=a.replace(h,"").replace(f,"")),!a&&t&&o.insert(t),o.wrap("<"+e+function(e){var t,r="";for(t in e)r+=" "+t+'="'+n(e[t]).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;")+'"';return r}(r)+">","</"+e+">"))};const p={source:{prompt:(e,t)=>i.prompt(e,t)},sourceHTML:{elements:{a:["a","link text goes here…",{}],area:["area",!1,{}],b:["strong","text goes here…",{}],base:["base",!1,{}],blockquote:["blockquote","",{}],br:["br",!1,{}],code:["code","code goes here…",{}],col:["col",!1,{}],em:["em","text goes here…",{}],h1:["h1","title goes here…",{}],h2:["h2","title goes here…",{}],h3:["h3","title goes here…",{}],h4:["h4","title goes here…",{}],h5:["h5","title goes here…",{}],h6:["h6","title goes here…",{}],hr:["hr",!1,{}],i:["em","text goes here…",{}],img:["img",!1,{alt:""}],input:["input",!1,{}],li:["li","",{}],link:["link",!1,{}],meta:["meta",!1,{}],ol:["ol","",{}],option:["option","option goes here…",{}],p:["p","paragraph goes here…",{}],param:["param",!1,{}],pre:["pre","text goes here…",{}],source:["source",!1,{}],strong:["strong","text goes here…",{}],td:["td","",{}],th:["th","",{}],tr:["tr","",{}],track:["track",!1,{}],u:["u","text goes here…",{}],ul:["ul","",{}],wbr:["wbr",!1,{}]}}},{toggle:a}=l;let s="[\\w:.-]+",u=e=>"<("+e+")(\\s(?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^/>'\"])*)?>",f=e=>"</("+e+")>";const h=p;e.canKeyDown=function(e,{a:t,c:r,s:n},i){let l=i.state,p=l.sourceHTML?.elements||{};if(l.tab,r){if("b"===e)return a.apply(i,p.b),!1;if("h"===e)return function(e){let t=/<(?:h([1-6])|p)(\s[^>]*)?>$/,r=/^<\/(?:h[1-6]|p)>/;e.match([t,/.*/,r],(function(e,n,o){let i=this,c=+(e[1]||0),l=e[2]||"";i.replace(t,"",-1),i.replace(r,"",1),i.trim("\n","\n"),c?(++c,c>6?i.wrap("<p"+l+">","</p>"):i.wrap("<h"+c+l+">","</h"+c+">")):i.wrap("<h1"+l+">","</h1>")}))}(i),i.record(),!1;if("i"===e)return a.apply(i,p.i),!1;if("k"===e)return function(e){let t=/<(?:pre|code)(?:\s[^>]*)?>(?:\s*<code(?:\s[^>]*)?>)?$/,r=/^(?:<\/code>\s*)?<\/(?:pre|code)>/;e.match([t,/.*/,r],(function(n,o,i){let c=this;c.replace(t,"",-1),c.replace(r,"",1),i[0]?/^(?:<\/code>\s*)?<\/pre>/.test(i[0])?c.trim(" "," ").insert(e.$().value.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")):"</code>"===i[0].slice(0,7)&&c.trim("\n","\n").wrap("<pre><code>","</code></pre>"):c.trim(" "," ").wrap("<code>","</code>").insert(e.$().value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"))}))}(i),i.record(),!1;if("u"===e)return a.apply(i,p.u),!1;if("Enter"===e){let e,{after:t,before:r,end:l,start:h,value:g}=i.$(),d=t.split("\n").shift(),m=r.split("\n").pop(),b=m.match(/^(\s+)/),$=b&&b[1]||"";if(""===g){e=d.match(c(f(s)+"\\s*$",""));let t=e&&e[1]||p.p[0];return n?(i.select(h-o(m)),a.apply(i,p[t]||p.p),i.replace(c("^("+f(s)+")\\s*(.)",""),"$1\n"+$+"$3",1),i.replace(c("(^|\\n)\\s*("+u(s)+")$",""),"$1"+$+"$2",-1),i.record(),!1):(i.select(l+o(d)),a.apply(i,p[t]||p.p),i.replace(c("(.)\\s*("+u(s)+")$",""),"$1\n"+$+"$2",-1),i.record(),!1)}return!0}}if(t||r)return!0;if("Enter"===e){let e,{after:t,before:r,value:n}=i.$(),l=t.split("\n").shift(),a=r.split("\n").pop(),s=a.match(/^(\s+)/),h=s&&s[1]||"";if(!n&&t&&r){let t,r=["li","option","p","td","th"];for(let n=0,s=o(r);n<s;++n)if((t=p[r[n]])&&(t=t[0],"</"+t+">"===l&&(e=a.match(c("^\\s*"+u(t),"")))))return e[0]===a?(i.replace(c(u(t)+"$",""),"",-1),i.replace(c("^"+f(t),""),"",1),i.record(),!1):(i.insert("</"+t+">\n"+h+"<"+t+(e[2]||"")+">",-1).record(),!1);for(let e=1;e<7;++e)if("</"+p["h"+e][0]+">"===l&&a.match(c("^\\s*"+u(p["h"+e][0]),"")))return i.insert("</"+p["h"+e][0]+">\n"+h+"<"+p.p[0]+">",-1).replace(c("^"+f(p["h"+e][0])),"</"+p.p[0]+">",1).record(),!1}}return!0},e.state=h}));